var _this=this;App.module("Checkout.Error",function(e,t,n,i,o,s){var a="gateway_failed_transaction";e.onStart=function(){e.errorHandlerMap={notification:e.displayNotification,recovery:e.displayRecovery,redirect:e.executeRedirect,fullscreen:e.executeFullscreen},e.recoveryHandlerMap={invalid_items:e.displayInvalidItemsMessage,insufficient_account_money_amount:e.displayGenericInvalidMessage,invalid_installment:e.displayGenericInvalidMessage,invalid_area_for_shipment:e.displayGenericInvalidMessageUncloseable,incomplete_payment_on_review:e.displayGenericInvalidMessageUncloseable,maximum_amount_exceeded:e.displayGenericInvalidMessage,minimum_amount_not_reached:e.displayGenericInvalidMessage,quantity_not_acceptable:e.displayGenericInvalidMessage,user_blocked_by_seller:e.displayInvalidItemsMessage,invalid_user_status:e.displayGenericInvalidMessage,not_active_item:e.displayInvalidItemsMessage,item_published_by_buyer:e.displayInvalidItemsMessage,not_recoverable_authorized_payment:e.displayGenericInvalidMessageUncloseable,dont_use_am_maximum_amount_exceeded:e.displayAccountMoneyPlusOtherMethodInvalidMessage,dont_use_am_invalid_installment:e.displayAccountMoneyPlusOtherMethodInvalidMessage,pay_total_amount_with_account_money:e.displayAccountMoneyPlusOtherMethodInvalidMessage,split_with_account_money:e.displayAccountMoneyPlusOtherMethodInvalidMessage},e.snackbarBaseCfg={hideDelay:4e3,type:"error",isInterceptedClose:!0,mountElement:"body"},e.bindEvents()},e.bindEvents=function(){t.channels.flow.on("error",e.handleFlowError),t.channels.flow.reply("response:hasErrors",e.responseHasErrors),t.channels.cho.on("gateway:failed",function(){e.showGatewayNotification(a)}),t.channels.cho.on("error:trackNewRelic",function(e){t.channels.cho.trigger("newRelic:track:error",e)}),t.channels.cho.on("notify:custom",e.customNotification)},e.responseHasErrors=function(t){var n=e.findErrors(t);return n&&e.handle(n),n},e.findErrors=function(e){if(!e||!e.steps)return void t.Checkout.ErrorService["throw"](new FlowError({method:"findErrors()",context:_this,reason:"The ajax API call returns without data or without steps"}));var n=e.currentStepId,i=void 0;if(i=n?s.findWhere(e.steps,{name:n}):e.steps[0],!i)return void t.Checkout.ErrorService["throw"](new FlowError({method:"findErrors()",context:_this,reason:"The ajax API call returns with a currentStepId that its not in the steps"}));var o=i.data&&t.Checkout.Helpers.isArrayAndContainsAtLeastOneValue(i.data.errors);return o?s.first(i.data.errors):null},e.handleFlowError=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.backgroundApiCall,o=void 0===i?!1:i;t.channels.core.trigger("modal:force:close"),o?e.handleSnackbarError():e.handleFatalError()},e.handleFatalError=function(){t.Config.fatalError&&t.Config.fatalError.metadata&&t.Checkout.router.navigate("gz/checkout/"+t.Config.entryPoint+"/fatalError")},e.handleSnackbarError=function(){var n=t.channels.flow.request("configs:get"),i=n.snackbarErrorMessage;e.displayNotification({code:"notification",type:"notification",metadata:{title:i}})},e.handle=function(n){var i=n.type;i&&i in e.errorHandlerMap?e.errorHandlerMap[n.type](n):t.channels.cho.trigger("error:trackNewRelic","App.Checkout.Error#handle: invalid error type: "+i)},e.isValidErrorObject=function(e){return e.code&&e.type&&e.metadata&&e.metadata.title},e.displayNotification=function(n){if(e.isValidErrorObject(n)){var i=n.metadata,o=Object.assign({},e.snackbarBaseCfg,{message:i.title});t.channels.core.trigger("spinner:hide"),t.channels.core.trigger("snackbar:open",o)}},e.customNotification=function(e){e&&(t.channels.core.trigger("spinner:hide"),t.channels.core.trigger("snackbar:open",{message:e,mountElement:"body"}))},e.executeRedirect=function(e){e.url&&(window.location.href=e.url)},e.executeFullscreen=function(){return!1},e.displayRecovery=function(n){var i=n.code;e.isValidErrorObject(n)&&i in e.recoveryHandlerMap?e.recoveryHandlerMap[i](n):t.channels.cho.trigger("error:trackNewRelic","App.Checkout.Error#displayRecovery: invalid error code: "+i)},e.displayGenericInvalidMessage=function(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,s=i.metadata,a=new n.Model(s),r=new t.Checkout.Views.Inconsistencies({model:a});e.showInModal({contentView:r,className:"ui-list ui-list--modal inconsistency-modal"},o)},e.displayAccountMoneyPlusOtherMethodInvalidMessage=function(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,s=i.metadata,a=new n.Model(s),r=new t.Checkout.Views.Inconsistencies({model:a});e.showInModal({contentView:r,className:"ui-list ui-list--modal modal-message--account-money"},o)},e.displayGenericInvalidMessageUncloseable=function(t){return e.displayGenericInvalidMessage(t,!1)},e.displayInvalidItemsMessage=function(i){var o=i.metadata,s=new n.Model({title:o.title,subtitle:o.subtitle}),a=new t.Checkout.Views.ModalWrapperHeader({model:s}),r=new t.Checkout.Collections.ItemsDetailsList(o.items),d=new t.Checkout.Views.ItemsDetailsList({collection:r}),l={containerClass:"unavailable-items-message ui-list--modal",headerView:a,contentView:d,contentClass:"ui-list__content"};t.Checkout.Helpers.isArrayAndContainsAtLeastOneValue(o.actions)&&(l.footerView=new t.Checkout.Views.Actions({collection:new n.Collection(o.actions),inCollection:!0}),l.footerClass="unavailable-items-message__actions"),e.showInModal(l,!1)},e.showInModal=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0,o=t.channels.core.request("modal:isOpen");o&&t.channels.core.trigger("modal:force:close"),t.channels.core.trigger("modal:open",{childView:new t.Checkout.Views.ContentWrapper(e),isClosable:n,isInterceptedClose:i})},e.showGatewayNotification=function(){t.channels.cho.trigger("app:fatalError")},e.on("start",function(){return e.onStart})}),App.module("Checkout.Models",function(e,t,n){var i=t.Checkout.GatewayTokenTypes,o=i.NEW_CARD,s=i.STORED_CARD,a=200,r=400,d=599,l=function(e){var t=e.value;return""===t||null===t||void 0===t},u=function(e){var t=e.value;return!l({value:t})},c=function(e){var t=e.model;return t.get("statusCode")>=a&&t.get("statusCode")<r},h=function(e){var t=e.model;return t.get("statusCode")>=r&&t.get("statusCode")<d},p=function(e){var t=e.model;return c({model:t})||h({model:t})},m=function(e){var t=e.value;return!isNaN(t)&&6===String(t).length},g=function(e){var t=e.model;return t.get("tokenType")===o},f=function(e){var t=e.model;return t.get("tokenType")===s},v=function(e){var t=e.model;return g({model:t})||f({model:t})},C=function(e){var t=e.value,n=e.model;return n.get("usesLuhn")?u({value:t}):l({value:t})},w=function(e){var t=e.value,n=e.model;return c({model:n})?u({value:t}):l({value:t})},y=function(e){var t=e.value,n=e.model;return h({model:n})?u({value:t}):l({value:t})},b=function(e){var t=e.value,n=e.model;return n.get("requestData").id?!0:u({value:t})},S=function(e){var t=e.value,n=e.model;return c({model:n})&&n.get("binHelper")&&"STANDARD"===n.get("binHelper").card_number_validation?u({value:t}):l({value:t})};e.GatewayLogEntry=n.DeepModel.extend({filePath:"src/scripts/models/gateway-log-entry.model.js",initialize:function(){var e=this.get("requestData"),n={},i=this.get("responseData"),o=this.get("selectedPayment"),s=this.get("binHelper"),a=t.Checkout.Form.Validations.luhn,r=this,d={};g({model:r})&&(d={paymentTypeID:s.payment_type_id,paymentMethodID:s.payment_method_id,issuerID:s.issuer.id,issuerName:s.issuer.name,bin:s.firstSixDigits,cardLength:s.card_number_length,usesLuhn:"STANDARD"===s.card_number_validation&&i.luhn_validation},d.usesLuhn&&(d.passesLuhn=a(this.get("requestData").card_number,d.cardLength)),Object.keys(d).forEach(function(e){return!d[e]&&delete d[e]})),f({model:r})&&(n.cardID=e.card_id);var l=i.responseJSON;this.set(Object.assign({bin:null,paymentTypeID:o.type,paymentMethodID:o.id,cardID:null,cardLength:null,issuerID:o.issuerId,issuerName:o.issuerName,isSplitPayment:2===this.get("requiredTokens"),isAccountMoneyPlusOtherMethod:!!t.Checkout.Payments.isUsingAccountMoney,statusCode:i.statusCode,tokenID:i.id,errorCode:i.statusCode>=400&&l.cause?l.cause[0].code:null,errorMessage:i.statusCode>=400?l.message:null,useESC:!!e.esc,generateESC:!!i.esc},d,n))},defaults:{userID:null,statusCode:null,errorCode:null,errorMessage:null,tokenType:null,bin:null,paymentTypeID:"UNKNOWN",paymentMethodID:"UNKNOWN",cardID:null,cardLength:null,issuerID:"UNKNOWN",issuerName:"UNKNOWN",usesLuhn:null,passesLuhn:null,isSplitPayment:null,isAccountMoneyPlusOtherMethod:null,tokenID:null,selectedPayment:null,binHelper:null,responseData:null,requestData:{},requiredTokens:null,useESC:!1,generateESC:!1},validationErrors:{userID:"expected userID to have a value",statusCode:"expected statusCode to have a value",errorCode:"errorCode must have a value if status !== 2XX",errorMessage:"errorMessage must have a value if status !== 2XX",tokenType:"expected tokenType to be either TokenTypes.NEW_CARD or TokenTypes.STORED_CARD",bin:"expected bin to a be a 6-digit number only if tokenType is NEW_CARD",paymentTypeID:"expected paymentTypeID to have a value",paymentMethodID:"expected paymentMethodID to have a value",cardID:"expected cardID to have a value only if tokenType is STORED_CARD",cardLength:"expected cardLength to have a value only if tokenType is NEW_CARD",issuerID:"expected issuerID to have a value",issuerName:"expected issuerName to have a value",usesLuhn:"expected usesLuhn to have a value only if tokenType is NEW_CARD",passesLuhn:"expected passesLuhn to have a value only if usesLuhn has a value",isSplitPayment:"expected isSplitPayment to have a value",isAccountMoneyPlusOtherMethod:"expected isAccountMoneyPlusOtherMethod to have a value",tokenID:"expected tokenID to have a value if status is 2XX",binHelper:"expected binHelper to have a value",responseData:"expected responseData to have a value",requestData:"expected requestData to have a value",selectedPayment:"expected selectedPayment to have a value",requiredTokens:"expected requiredTokens to have a value"},validations:{userID:[u],statusCode:[u,p],errorCode:[y],errorMessage:[y],tokenType:[u,v],bin:{newCard:[m],storedCard:[l]},paymentTypeID:[u],paymentMethodID:[u],cardID:{newCard:[l],storedCard:[b]},cardLength:{newCard:[u],storedCard:[l]},issuerID:[u],issuerName:[u],usesLuhn:{newCard:[S],storedCard:[l]},passesLuhn:{newCard:[C],storedCard:[l]},isSplitPayment:[u],isAccountMoneyPlusOtherMethod:[u],tokenID:[w],binHelper:{newCard:[u],storedCard:[l]},responseData:[u],requestData:[u],selectedPayment:[u],requiredTokens:[u],useESC:[u],generateESC:[u]},validate:function(e){var n=this;Object.keys(e).forEach(function(i){var a=e[i],r=n.validations[i],d=o in r&&s in r,l=n.validationErrors[i],u=r;d&&(u=u[n.get("tokenType")]);var c=n.resolveValidator({value:a,validationList:u});return c?void 0:(t.Checkout.ErrorService["throw"](new MissingDataError({method:"validate()",missingKey:i,context:n,type:MissingDataError.type.DATA,reason:l,severity:t.Checkout.ErrorService.severity.WARNING})),l)})},resolveValidator:function(e){var t=this,n=e.value,i=e.validationList,o=void 0===i?[]:i,s=!0;return o.forEach(function(e){var i=e({value:n,model:t});s=s&&i}),s},buildTokenTransactionLabel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.failed,n=void 0===t?!1:t;return["GW",n?"ERROR":"OK",this.get("tokenType"),this.get("paymentTypeID"),this.get("useESC")?"ESC":"CVV",this.get("generateESC")?"ESC_GENERATED":"ESC_NO_GENERATED",this.get("paymentMethodID"),this.get("issuerName"),this.get("bin")].join("/").toUpperCase()},buildLuhnTransactionLabel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.failed,n=void 0===t?!1:t;return["LUHN",n?"ERROR":"OK",this.get("paymentTypeID"),this.get("paymentMethodID"),this.get("issuerName")+"#"+this.get("cardLength"),this.get("bin")].join("/").toUpperCase()}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.ShippingCost=i.ItemView.extend({tagName:"li",className:"item-detail-row",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._shippingCost,'[data-component="shipping-cost"]')}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.SelectInstallment=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._selectInstallment,'[data-component="select-installment"]')},ui:{submitButton:'[data-js="select-installment"]'},events:{"click @ui.submitButton":"handleSubmit"},behaviors:function o(){var o={};return this.options.disableViewTracking||(o.TrackingInputs={behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepInstallment"],trackIfPresent:!0}),o},templateHelpers:function(){return{withoutFeeText:this.options.withoutFeeText,withoutFee:this.options.withoutFee,selectionMessageText:this.options.selectionMessageText,inputs:t.channels.flow.request("step:data").inputs}},handleSubmit:function(e){e.preventDefault(),this.options.onSubmit&&("preventDefaultBehavior"===this.options.onSubmit?this.preventDefaultBehavior():"function"==typeof this.options.onSubmit&&this.options.onSubmitConfig&&this.options.onSubmit(this.options.onSubmitConfig))},preventDefaultBehavior:function(){}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.PaymentType=i.ItemView.extend({tagName:"li",className:"badge-type-selection__list-item",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._paymentType,'[data-js = "payment-type"]')},templateHelpers:function(){return{inputs:this.options.inputs}}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o){e.PaymentMethod=i.ItemView.extend({tagName:"li",className:function(){return"cardIssuerId"===this.options.output?"payment-method__menu-item ui-list__item":"badge-type-selection__list-item"},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._paymentMethod,'[data-js="payment-method"]')},ui:{button:'[data-js="payment-method"]'},events:{"click @ui.button":"handleClickSend"},modelEvents:{change:"render"},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}},templateHelpers:function(){return{output:this.options.output}},handleClickSend:function(e){e.preventDefault(),this.send(o(e.currentTarget).val())},send:function(e){var n=this;this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:this.options.output,value:e}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.PaymentDetailHeader=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._paymentDetailHeader,'[data-component="payment-detail-header"]')},ui:{paymentDetailTrigger:'[data-js="payment-detail-trigger"]'},events:{"submit @ui.paymentDetailTrigger":"handleSubmit"},handleSubmit:function(e){this.options.onSubmit&&("preventDefaultBehavior"===this.options.onSubmit?this.preventDefaultBehavior():"function"==typeof this.options.onSubmit&&this.options.onSubmit(this.options.onSubmitConfig)),e.preventDefault()},preventDefaultBehavior:function(){},templateHelpers:function(){return{imagesHeight:this.options.imagesHeight||48,imagesWidth:this.options.imagesWidth||48}}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.ModalInstallmentsActions=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._modalInstallmentsActions,'[data-component="installments-actions"]')},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}},ui:{changePayment:'[data-js="change-payment"]'},events:{"click @ui.changePayment":"changePayment"},changePayment:function(e){var n=this;e.preventDefault();var i=t.channels.flow.request("input:get",{name:"nextStepPayments"});this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:i.output,value:i.output}),t.channels.flow.once("saved",function(){n.trigger("flowSaved"),n.closeModal()}),t.channels.flow.trigger("save")},closeModal:function(){t.channels.core.trigger("modal:close")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.ItemsDetailsHeader=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._itemsDetailsHeader,'[data-component="items-details-header"]')},templateHelpers:function(){return{withoutFeeText:this.options.withoutFeeText}}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.InvoiceComponent=i.VDomItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._invoice,'[data-component="invoice"]')},modelEvents:{change:"render","change:docNumber":"updateIdentificationMask","change:docNumberPattern":"updateIdentificationPlaceholder","change:namePlaceholderToUse":"updateOwnerPlaceholder","change:firstName":"updateOwnerName","change:lastName":"updateOwnerName","change:legalName":"updateOwnerName"},updateOwnerPlaceholder:function(){var e=this.model.get("namePlaceholderToUse");this.model.set("invoiceOwnerPlaceholder",this.model.get(e+"Placeholder")),this.updateOwnerName()},updateOwnerName:function(){var e=this,t=this.model.get("namePlaceholderToUse"),n={surnameName:function(){return e.model.get("lastName")+" "+e.model.get("firstName")},name:function(){return e.model.get("firstName")+" "+e.model.get("lastName")},legalName:function(){return e.model.get("legalName")}};this.model.set("invoiceOwner",(n[t]()||"").trim()||null)},updateIdentificationMask:function(){var e=this.model.get("docType"),t=this.model.get("docNumber"),n=this.model.get("identificationPlaceholder"),i=n.split("");if(!window.requestAnimationFrame){for(var o=0,s=void 0,a=/\*/g;null!==(s=a.exec(n));)i[s.index]=t[o],o+=1;t=i.join("").replace(/[^0-9]+$/g,"")}n&&t&&(n=n.substr(t.length)),this.model.set("identificationType",e),this.model.set("identificationEntry",t),this.model.set("identificationMasked",n)},updateIdentificationPlaceholder:function(){var e=this.model.get("invoiceFormat");e?this.model.set("identificationPlaceholder",e):this.convertPatternToMask(),this.updateIdentificationMask()},convertPatternToMask:function(){var e=this,n=[],i=this.model.get("docNumberPattern"),o=this.model.get("docNumberMaxLength");if(i){var s=i.replace(/[^\d,.]/g,"").split(".").map(function(e){var t=e.search(/\d/);return e.slice(t,1)}).map(function(n){return n&&Number.isInteger(parseInt(n,10))?Array(Number(n)+1).join("*"):(t.Checkout.ErrorService["throw"](new MissingDataError({method:"convertPatternToMask()",missingKey:"pattern",context:e,type:MissingDataError.type.DATA,reason:"Missing or wrong docNumberPattern",severity:t.Checkout.ErrorService.severity.WARNING})),null)}),a=i.replace(/[^.\-\/]/g,"").split("");n.push(_.flatten(_.zip(s,a)).join(""))}else o?n.push(Array(o+1).join("*")):t.Checkout.ErrorService["throw"](new MissingDataError({method:"convertPatternToMask()",missingKey:"maxLength/pattern",context:this,type:MissingDataError.type.DATA,reason:"Missing or wrong docNumber constraints",severity:t.Checkout.ErrorService.severity.WARNING}));this.model.set("identificationPlaceholder",n.join(" "))}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.Installment=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._installment,'[data-component="installment"]')},ui:{installmentForm:'[data-js="installment-form"]'},events:{"submit @ui.installmentForm":"handleSubmit"},behaviors:function o(){var o={};return this.options.singleOptionView&&(o.TrackingInputs={behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepInstallment"],trackIfPresent:!0}),o.Spinner={behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"},o},tagName:function(){return this.options.tagName||"li"},className:function(){var e=["ui-list__item"];return this.model.get("disabled")?e.push("ui-list__item--disabled"):this.model.get("selected")&&e.push("ui-list__item--selected"),e.join(" ")},templateHelpers:function(){return{withoutFeeText:this.options.withoutFeeText,showChevron:this.options.showChevronIfSelected?this.model.get("selected"):this.options.showChevron,chevronClasses:this.options.chevronClasses,inputs:t.channels.flow.request("step:data").inputs,singleOptionView:this.options.singleOptionView,paymentId:this.options.paymentId,withoutFee:null===this.model.get("totalAmount")}},handleSubmit:function(e){e.preventDefault();var n=this.model.get("selected");return this.model.get("disabled")||n&&this.options.isModalView?void t.channels.core.trigger("modal:close"):void(this.options.onSubmit?"preventDefaultBehavior"===this.options.onSubmit?this.preventDefaultBehavior():"function"==typeof this.options.onSubmit&&this.options.onSubmitConfig&&this.options.onSubmit(this.options.onSubmitConfig):this.saveInstallment())},preventDefaultBehavior:function(){},checkAdditionalDataToSend:function(){var e=this.model.get("additionalInputs");t.channels.flow.trigger("output:add",e)},saveInstallment:function(){var e=this;this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:t.channels.flow.request("input:get",{name:"installmentsSelection"}).output,value:this.model.get("installment")}),this.options.paymentId&&t.channels.flow.trigger("output:add",{key:t.channels.flow.request("input:get",{name:"paymentIntentionId"}).output,value:this.options.paymentId});var n=t.channels.flow.request("input:get",{name:"nextStepInstallment"});n&&t.channels.flow.trigger("output:add",{key:n.output,value:n.output}),this.checkAdditionalDataToSend(),t.channels.flow.once("saved",function(){e.trigger("flowSaved"),t.channels.core.trigger("modal:close")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.DocumentContainer=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Components.templates.document,'[data-js="card"]')},className:"new-document__container--view",ui:{card:".ui-document"},initialize:function(){var e=this;this.modelEvents={},this.model.keys().forEach(function(t){e.modelEvents["change:"+t]=function(){e.onModelChange({key:t})}}),this.bindEntityEvents(this.model,this.modelEvents)},onShow:function(){var e=this;this.documentComponent=new DocumentComponent({site:t.Config.siteId}),this.documentComponent.type=this.options.defaultDocumentType,this.documentComponent.title=this.options.documentTypesTitles[this.options.defaultDocumentType],Object.keys(this.options.documentTypesTitles).forEach(function(n){var i=e.documentComponent.types;i[t.Config.siteId.toLowerCase()][n].name=n}),this.on("updateDocumentComponent",this.setDocumentComponentByType)},setDocumentComponentByType:function(e){var t=this.options.documentTypesTitles,n=t[e];this.documentComponent.type=e,this.documentComponent.title=n},onModelChange:function(e){var t=e.key;"rotate"===t&&this.triggerMethod("rotate",this.model.get(t)?"front":"back"),this.documentComponent[t]=this.model.get(t)}})}),App.module("Checkout.Review.Views",function(e,t,n,i){e.ChangeInstallmentsHeader=i.ItemView.extend({className:"ui-list__header",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.review._changeInstallmentsHeader,'[data-component="change-installments-header"]')}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o){var s={cardNumber:"number",ownerName:"name",expirationDate:"expiration",securityCode:"security",brand:"brand"};e.CardContainer=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Components.templates.card,'[data-js="card"]')},className:"new-card__container--view",ui:{card:".ui-card"},initialize:function(){var e=this;this.on("refresh",this.onCardRefresh),this.on("rotate",this.onRotate),this.on("brandSet",this.onBrandSet),this.on("showSecurityHint",this.onShowSecurityHint),this.modelEvents={},this.model.keys().forEach(function(t){"binHelper"!==t&&(e.modelEvents["change:"+t]=function(){return e.onCardDataChanged({key:t,rotate:"securityCode"===t})})}),this.bindEntityEvents(this.model,this.modelEvents),this.brandSet=!1},onBrandSet:function(){this.brandSet=!0},onShow:function(){this.cardComponent=new CardComponent,o(this.cardComponent.cardElements.name).attr("data-title",this.model.get("ownerNamePlaceholder")),this.trigger("refresh")},onCardRefresh:function(){var e=this;this.model.keys().forEach(function(t){e.model.trigger("change:"+t,{rotate:!1})})},onCardDataChanged:function(e){var t=e.key+"Changed",n=t.replace(/\w{1}/,function(e){return e.toUpperCase()}),i="on"+n;this.triggerMethod(this[i]instanceof Function?t:"otherCardDataChanged",e.key)},onCardNumberChanged:function(e){var t=this.model.get(e);this.cardComponent[s[e]]=this.model.get(e),t.length<6&&(this.model.set("brand",""),this.model.set("bin",""),this.brandSet=!1)},onCardOwnerNameChanged:function(e){var t=this.model.get(e)||this.model.get("ownerNamePlaceholder");this.cardComponent[s[e]]=t},onOtherCardDataChanged:function(e){this.cardComponent[s[e]]=this.model.get(e),""!==this.model.get("brand")&&this.trigger("brandSet")},onRotate:function(e){"front"===e?(this.cardComponent.rotateFront(),this.cardComponent.blur="securityFront"):"back"===e&&this.cardComponent.rotateBack()},onShowSecurityHint:function(){this.cardComponent.focus="securityFront"}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.CvvInstructionsContainer=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.cvvInstructions,'[data-js="cvv-instructions"]')},className:"cvv-instructions__container--view",templateHelpers:function(){return{icon:this.model.get("icon"),title:this.model.get("title"),description:this.model.get("description")}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.AddressSelectionHeader=i.ItemView.extend({template:t.Checkout.templates.components.shipping._addressSelectionHeader})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.Address=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._address,'[data-component="address"]')},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},className:function(){var e="";return this.options.inCollection&&(e=this.model.get("selected")?"ui-list__item ui-list__item--selected":"ui-list__item"),e},tagName:function(){return this.options.inCollection?"li":"div"},ui:{addressForm:'[data-js="address-form"]'},events:{"submit @ui.addressForm":"handleSubmit"},handleSubmit:function(e){e.preventDefault(),this.selectAddress()},templateHelpers:function(){return{zipCodeText:this.options.zipCodeText,inputs:t.channels.flow.request("step:data").inputs}},selectAddress:function(){var e=this,n=this.model.get("selected"),i=t.channels.flow.request("step:data").data.isSplit;if(this.trigger("beginSave"),n)return void t.channels.core.trigger("modal:close");var o=t.channels.flow.request("input:get",{name:"nextStepAddressChange"}).output,s=t.channels.flow.request("input:get",{name:"splitAddressModification"});t.channels.flow.trigger("output:add",{key:t.channels.flow.request("input:get",{name:"addressId"}).output,value:this.model.get("id")}),t.channels.flow.trigger("output:add",{key:o,value:o}),i&&s&&t.channels.flow.trigger("output:add",{key:s.output,value:s.output}),t.channels.flow.once("saved",function(){e.trigger("flowSaved"),e.closeModal()}),t.channels.flow.trigger("save")},closeModal:function(){t.channels.core.trigger("modal:close")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.AddressesActions=i.ItemView.extend({filePath:"src/scripts/modules/shipping/views/addresses-actions.item.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._addressesActions,'[data-component="addresses-actions"]')},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},ui:{newAddressButton:'[data-js="new-address"]'},events:{"click @ui.newAddressButton":"newAddress"},newAddress:function(e){var n=this;e.preventDefault(),this.trigger("beginSave");var i=this.model.get("nextStepAddress");return i?(t.channels.flow.trigger("output:add",{key:i.output,value:i.value}),t.channels.flow.once("saved",function(){n.trigger("flowSaved"),n.closeModal()}),void t.channels.flow.trigger("save")):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"newAddress()",missingKey:"nextStepAddress",context:this,type:MissingDataError.type.DATA,reason:"nextStepAddress data was not found",severity:t.Checkout.ErrorService.severity.CRITICAL}))},closeModal:function(){t.channels.core.trigger("modal:close")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.AddressesHeader=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shared.uiList._uiListHeader,'[data-component="addresses-header"]')},templateHelpers:function(){return{title:this.options.title}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.Contact=i.ItemView.extend({tagName:"li",className:"badge-type-selection__list-item",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._contact,'[data-js="shipping-contact"]')},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},ui:{button:'[data-js="contact-option"]'},events:{"click @ui.button":"handleClickSend"},modelEvents:{change:"render"},templateHelpers:function(){return{output:this.options.output}},handleClickSend:function(e){e.preventDefault(),this.send(this.model.get("id"))},send:function(){var e=this;this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:this.model.get("id"),value:this.model.get("id")}),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i,o){e.SelectionListItem=i.ItemView.extend({tagName:"li",className:"selection-list__menu-item ui-list__item",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._selectionListItem,'[data-js="selection-list-item-wrapper"]')},ui:{button:'[data-js="selection-list-item"]'},events:{"click @ui.button":"handleClickSend"},modelEvents:{change:"render"},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}},templateHelpers:function(){return{output:this.options.output}},handleClickSend:function(e){e.preventDefault(),this.send(o(e.currentTarget).val())},send:function(e){var n=this;this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:this.options.output,value:e}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i,o){e.ShippingContext=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._shippingContext,'[data-component="shipping-context"]')},ui:{showAddressesForm:'[data-js="show-addresses"]',hero:'[data-id="hero-shipping"]',heroInfoContainer:'[data-js="hero-info"]',heroElements:'[data-id="hero-shipping-subtitle"]',heroIcon:'[data-js="hero-icon"]'},events:{"submit @ui.showAddressesForm":"checkAddressState","click @ui.showAddressesForm":"checkAddressState","click @ui.heroInfoContainer":"showAddressList","click @ui.heroIcon":"showAddressList"},onBeforeDestroy:function(){o(window).off("resize.shippingContext"),this.requestAnimationId&&(window.cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=null)},templateHelpers:function(){var e=this.model.get("selectedAddress");return{selectedAddress:e&&Object.keys(e).length>0?e:null}},behaviors:function(){return{AddressSelectionCaller:{behaviorClass:t.Checkout.Behaviors.AddressSelectionCaller,isModal:!0
},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepAddressChange"],trackIfPresent:!0}}},hasAddresses:function(){var e=this.model.get("addressList"),t=e.addressListData,n=void 0===t?[]:t;return n.length>0},checkAddressState:function(e){e.preventDefault();var i=this.model.get("selectedAddress").isNewAddress,o=new n.Model({data:this.model.get(),inputs:this.model.get("inputs")});return i?void this.triggerMethod("displayAddressFlow",o):this.hasAddresses()?void(this.options.isAddressHubEnable?this.goToAddressHub():this.triggerMethod("displayAddressList",o)):void t.channels.flow.trigger("save")},goToAddressHub:function(){var e=this;this.trigger("beginSave");var n=this.model.get("inputs.nextStepAddressHub");n&&t.channels.flow.trigger("output:add",{key:n.output,value:n.output}),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")},showAddressList:function(e){if(e.preventDefault(),this.hasAddresses()){var t=new n.Model({data:this.model.toJSON(),inputs:this.model.get("inputs")});this.triggerMethod("displayAddressList",t)}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.NewAddressContext=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._addressContext,'[data-component="new-address-context"]')},templateHelpers:function(){return{destinationContext:this.options.destinationContext}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingOption=i.ItemView.extend({tagName:function(){return this.options.inCollection?"li":"div"},className:function(){var e="",n=t.Config.device;return this.options.inCollection&&(e=this.model.get("selected")&&"mobile"!==n?"ui-list__item ui-list__item--selected":"ui-list__item"),e},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._shippingOption,'[data-component="shipping-option"]')},ui:{shippingOptionsForm:".shipping-option-form"},events:{"submit @ui.shippingOptionsForm":"handleSubmit"},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},templateHelpers:function(){return{shippingOptionsSelectionView:this.options.shippingOptionsSelectionView,packageId:this.options.packageId,hideChevron:this.options.hideChevron,inputs:t.channels.flow.request("step:data").inputs,collectionView:this.options.inCollection,autoRipple:this.options.autoRipple,isPackage:this.options.isPackage}},handleSubmit:function(e){e.preventDefault(),this.selectShippingOption()},selectShippingOption:function(){var e=this,n=this.model.get("selected");if(n&&this.options.isModalView)return void t.channels.core.trigger("modal:close");this.trigger("beginSave");var i=t.channels.flow.request("input:get",{name:"nextStepShippingOption"}),o=t.channels.flow.request("input:get",{name:"packageId"});t.channels.flow.trigger("output:add",{key:t.channels.flow.request("input:get",{name:"selectedShippingOption"}).output,value:this.model.get("id")}),o&&t.channels.flow.trigger("output:add",{key:o.output,value:this.options.packageId}),i&&t.channels.flow.trigger("output:add",{key:i.output,value:i.output}),t.channels.flow.once("saved",function(){e.trigger("flowSaved"),t.channels.core.trigger("modal:close")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingOptionsHeader=i.ItemView.extend({template:t.Checkout.templates.components.shipping._shippingOptionsHeader,templateHelpers:function(){return{packsConfigsContext:this.options.packsConfigsContext,imagesWidth:"35",imagesHeight:"35"}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingAddressInfo=i.ItemView.extend({filePath:"src/scripts/views/hero.item.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._shippingAddressInfo,'[data-component="shipping-address-info"]')},templateHelpers:function(){var e=this.model.get("selectedAddress");return{buttonValue:e.buttonText,description:e.description,title:e.title}},behaviors:{AddressSelectionCaller:{behaviorClass:t.Checkout.Behaviors.AddressSelectionCaller,isModal:!0},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}},ui:{showAddressList:'[data-js="show-addresses-list"]',showAddresses:'[data-js="show-addresses"]'},events:{"click @ui.showAddressList":"showAddressList","click @ui.showAddresses":"checkAddressState"},hasAddresses:function(){var e=this.model.get("addressList"),t=e.addressListData,n=void 0===t?[]:t;return n.length>0},checkAddressState:function(e){e.preventDefault();var i=this.model.get("selectedAddress").isNewAddress,o=new n.Model({data:this.model.toJSON(),inputs:this.model.get("inputs")});return i?void this.triggerMethod("displayAddressFlow",o):this.hasAddresses()?void(this.options.isAddressHubEnable?this.goToAddressHub():this.triggerMethod("displayAddressList",o)):void t.channels.flow.trigger("save")},goToAddressHub:function(){var e=this;this.trigger("beginSave");var n=this.model.get("inputs.nextStepAddressHub");n&&t.channels.flow.trigger("output:add",{key:n.output,value:n.output}),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")},showAddressList:function(e){if(e.preventDefault(),!this.options.isAddressHubEnable&&this.hasAddresses()){var t=new n.Model({data:this.model.toJSON(),inputs:this.model.get("inputs")});this.triggerMethod("displayAddressList",t)}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.HubAddresses=i.ItemView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._addressCard,'[data-js="address-card-form"]')},ui:{addressCardForm:'[data-js="address-card-form"]',editAddressButton:'[data-js="edit-address-button"]',addDeliveryInstructionButton:'[data-js="add-delivery-instruction-button"]'},triggers:{"click @ui.addressCardForm":"addressCardFormClick","click @ui.editAddressButton":"editAddressButtonClick","click @ui.addDeliveryInstructionButton":"addDeliveryInstructionButtonClick"},onShow:function(){this.model.set("editAddressText",this.options.editAddressText),this.model.set("deliveryInstructionText",this.options.deliveryInstructionText)}})}),App.module("Checkout.Congrats.Views",function(e,t,n,i){e.CongratsAgenciesOffMapLayout=i.LayoutView.extend({filePath:"src/scripts/modules/congrats/views/congrats-agencies-off-map.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.congratsAgenciesOffMap,'[data-component="congrats-agencies-off-map"]')},className:function(){return"congrats-agencies-off-map"},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["beginSave","google:spinner:show"],hideOn:["flowSaved","google:spinner:hide"]},MapPosition:{behaviorClass:t.Behaviors.MapPosition},AgenciesFetch:{behaviorClass:t.Behaviors.AgenciesFetch}},ui:{map:'[data-component="map"]',infoBox:'[data-js="info-box"]'},regions:{map:"@ui.map"},initialize:function(){var e="https://http2.mlstatic.com/resources/frontend/statics/buyingflow-frontend-core/scripts/cho__map.js";t.Checkout.assetsLoader.addScript(e),this.once("agencies:fetch:success",this.mapDataFetchResponseHandler.bind(this)),this.once("agencies:fetch:empty",this.mapDataFetchResponseHandler.bind(this)),this.once("agencies:fetch:error",this.mapDataFetchError.bind(this)),t.channels.cho.once("google:maps:loaded",this.handlerGoogleLoaded.bind(this))},onShow:function(){this.trigger("google:spinner:show")},handlerGoogleLoaded:function(){var e=this.model.get("data.geolocation");this.triggerMethod("fetch:map:data",e,"geo_location")},onPositionSuccess:function(e){this.model.set("data.geolocation",e)},onPositionFinished:function(){var e=this.model.get("googleMapsConfig");return e?void t.channels.cho.trigger("google:maps:load",e):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"onShow()",missingKey:"googleMapsConfig",context:this,type:MissingDataError.type.DATA,reason:"googleMapsConfig is required",severity:t.Checkout.ErrorService.severity.WARNING}))},mapDataFetchResponseHandler:function(e){var t=this.buildModel(),n=this.model.get("data.geolocation");t.set("data.mapData",e.toJSON()),t.set("data.geolocation",n);var i=e.get("defaults.defaultType");t.set("data.defaultType",i),this.renderMap(t),this.trigger("google:spinner:hide")},renderMap:function(e){var n=new t.Checkout.Views.MapAgencies({model:e});this.getRegion("map").show(n)},mapDataFetchError:function(){t.channels.cho.trigger("app:fatalError")},unbindMapEvents:function(){t.channels.cho.off("google:maps:loaded"),this.off("agencies:fetch:success"),this.off("agencies:fetch:empty"),this.off("agencies:fetch:error")},onDestroy:function(){this.unbindMapEvents()}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){var o="surnameName",s="legalName";e.UserIdentification=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.userIdentification,'[data-component="user-identification"]')},ui:{heading:'[data-js="stepTitle-heading"]',invoiceContainer:'[data-js="card-container"]',formContainer:'[data-component="user-identification-form"]',docNumberInput:'[data-input-id="docNumber"]',submitButton:'[data-js="submit-btn"]'},events:{"input @ui.docNumberInput":"onDocNumberInput","click @ui.submitButton":"handleSubmit"},regions:{invoiceContainer:"@ui.invoiceContainer"},handleSubmit:function(e){e.preventDefault(),this.send()},behaviors:function a(){var e=this.getStepInputs(),a={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,submitButtonText:this.options.model.get("data").stepContext.submitButtonText,isNavigable:!1,hasCard:!0,inputs:e},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}};return window.requestAnimationFrame||(a.FormatlessPaste={behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["docNumber"],validMaskRegex:/[^0-9]/g}),a},onShow:function(){this.bindEvents(),this.focusHeading()},focusHeading:function(){this.ui.heading.focus()},bindEvents:function(){this.on("formShown",this.onFormShown.bind(this)),this.on("formComplete",this.send.bind(this)),this.on("input:value:changed",this.onInputValueChanged.bind(this)),window.requestAnimationFrame||this.on("input:pastedWithoutFormat",this.onInputValueChanged.bind(this))},setFormatlessHints:function(){var e=this.model.get("data");this.getInputModelById("docNumber").set("data.prompt",e.userIdentificationContext.writeOnlyNumbers)},getStepInputs:function(){return this.options.model.get("inputs")},onFormShown:function(){this.bindUIElements(),this.initializeInvoiceComponent(),window.requestAnimationFrame||this.setFormatlessHints()},buildInvoiceModel:function(){var e=this.model.get("data").userIdentificationContext,n=new t.Checkout.Payments.Models.Invoice({title:this.model.get("title"),namePlaceholder:e.namePlaceholder,legalNamePlaceholder:e.legalNamePlaceholder,surnameNamePlaceholder:e.surnameNamePlaceholder,namePlaceholderToUse:"",showInvoiceOwner:!!this.getInputModelById("firstName")&&!!this.getInputModelById("legalName")});return n},initializeInvoiceComponent:function(){this.invoiceModel=this.buildInvoiceModel(),this.invoiceView=new e.InvoiceComponent({model:this.invoiceModel}),this.setEntity(),this.setNamePlaceholder(),this.getInputModelById("docNumber")&&this.preloadUserIdentification(),this.getRegion("invoiceContainer").show(this.invoiceView)},preloadUserIdentification:function(){var e=this.getInputModelById("docNumber"),t=this.getInputModelById("docType"),n=e.getConstraint("pattern")||"",i=e.getConstraint("maxLength")||20,o=this.getInputModelById("firstName"),s=this.getInputModelById("lastName"),a=this.getInputModelById("legalName"),r=this.model.get("data").userIdentificationContext;this.invoiceModel.set({docType:t.get("data.value")||null,invoiceFormat:r.invoiceFormat||null,docNumberPattern:n.value||null,docNumberMaxLength:i.value,docNumber:e.get("data.value",{formatted:!0})}),o&&s?this.invoiceModel.set({firstName:o.get("data.value")||"",lastName:s.get("data.value")||""}):a&&this.invoiceModel.set({legalName:a.get("data.value")||""})},getNaturalNamePlaceholder:function(){return o},setNamePlaceholder:function(){var e=this.getInputModelById("firstName"),t=this.getInputModelById("legalName"),n="";e&&"hidden"!==e.get("type")?n=this.getNaturalNamePlaceholder():t&&"hidden"!==t.get("type")&&(n=s),this.invoiceModel.set("namePlaceholderToUse",n)},setEntity:function(){var e=this.getInputModelById("entityType");e&&this.invoiceModel.set({entityType:e.get("data.value")||e.get("data.title")})},onInputValueChanged:function(e){var t=e.model,n=t.get("id");"docNumber"===n?this.handleDocNumberChanged(t):"docType"===n?this.handleDocTypeChanged(t):"entityType"===n?this.setEntity():this.invoiceModel.set(n,t.get("data.value"))},handleDocNumberChanged:function(e){var t=this,n=e.get("id"),i=function(e){e()};(window.requestAnimationFrame||i)(function(){e.removeConstraint("invalidRemoteConstraint",!0),t.invoiceModel.set(n,e.get("data.value",{formatted:!0}))})},handleDocTypeChanged:function(e){var t=e.get("id");this.invoiceModel.set(t,e.get("data.value",{formatted:!0})),this.setNamePlaceholder();var n=this.getInputModelById("docNumber"),i=n.getConstraint("pattern");this.invoiceModel.set({docNumberPattern:i.value||""}),this.preloadUserIdentification(),this.getInputViewByModel(n).setFocus()},addOutputsToFlow:function(){var e=this.getInputCollection(),n=e.reject(function(e){return"nextStepPayments"===e.get("id")}).map(function(e){var t=e.get("data.value"),n=e.get("output");return"number"===n&&(t=e.get("data.value",{formatted:!1})),{id:n,output:t}});t.channels.flow.trigger("output:add",n)},send:function(){var e=this;this.trigger("beginSave"),this.isFormValid()?(this.addOutputsToFlow(),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")):this.trigger("flowSaved")},onDocNumberInput:function(e){e.preventDefault();var t=this.getInputModelById("docNumber");t.removeConstraint("invalidRemoteConstraint",!0)},updateDocNumberState:function(e){var t=e.hasError,n=e.stepData,i=n.inputs.docNumber,o=this.getInputModelById(i.id);t?(o.addConstraint({name:"nonEquals",value:i.data.value,errorMessage:i.error}),o.addConstraint({name:"invalidRemoteConstraint",errorMessage:i.error},!0)):o.removeConstraint("invalidRemoteConstraint",!0)}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.UiCards=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._uiCards,'[data-component="ui-cards"]')},className:"ui-cards-container",ui:{cardContainer:'[data-js="ui-credit-card-component"]',cvvInstructionsContainer:'[data-js="ui-cvv-instructions-component"]',documentContainer:'[data-js="ui-document-card-component"]'},regions:{cardContainer:"@ui.cardContainer",cvvInstructionsContainer:"@ui.cvvInstructionsContainer",documentContainer:"@ui.documentContainer"},initialize:function(){this.documentCardEnabled=!!this.options.documentModel&&!!this.options.documentContext},onShow:function(){this.setCreditCard(),this.documentCardEnabled&&this.setDocumentCard(),this.setCvvInstructions(),this.setAnimation()},setAnimation:function(){this.cardAnimation=new TweenLite.to(this.cardContainerView.$el,1,{opacity:.5,x:"-100%",paused:!0,ease:Elastic.easeInOut.config(1,1)}),this.documentCardEnabled&&(this.DocumentAnimation=new TweenLite.to(this.documentContainerView.$el,1,{opacity:1,x:"-70%",paused:!0,ease:Elastic.easeInOut.config(1,1)})),this.cvvInstructionsAnimation=new TweenLite.to(this.cvvInstructionsContainerView.$el,1,{opacity:1,x:"-23%",paused:!0,ease:Elastic.easeInOut.config(1,1)})},setDocumentCard:function(){this.documentContainerView=new e.DocumentContainer({model:this.options.documentModel,documentTypesTitles:this.options.documentContext.documentTypesTitles,defaultDocumentType:this.options.documentContext.defaultDocumentType}),this.getRegion("documentContainer").show(this.documentContainerView)},setCvvInstructions:function(){var t=this.options.documentContext&&this.options.documentContext.dynamicCvvInstructions?this.options.documentContext.dynamicCvvInstructions:{};this.cvvInstructionsContainerView=new e.CvvInstructionsContainer({model:new n.Model(t)}),this.getRegion("cvvInstructionsContainer").show(this.cvvInstructionsContainerView)},setCreditCard:function(){this.cardContainerView=new e.CardContainer({model:this.options.cardModel}),this.getRegion("cardContainer").show(this.cardContainerView)},flipCardIfNeeded:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1;"security_code"===e?n?(this.cardAnimation.play(),this.cvvInstructionsAnimation.play()):this.cardContainerView.trigger("rotate","amex"===t?"front":"back"):this.cardContainerView.trigger("rotate","front")},showSecurityHint:function(e,t){var n=t.split("_")[0];"security_code"===e&&"amex"===n&&this.cardContainerView.trigger("showSecurityHint")},updateCards:function(e){var t=this.options.cardModel.get("brand"),n=e.attr("name"),i=this.options.documentContext&&this.options.documentContext.dynamicCvvInstructions;return this.documentCardEnabled?void("user_identification_number"===n?(this.cardAnimation.play(),this.DocumentAnimation.play(),this.cvvInstructionsAnimation.reverse()):(this.DocumentAnimation.reverse(),this.cardAnimation.reverse(),this.cvvInstructionsAnimation.reverse(),this.flipCardIfNeeded(n,t,i),this.showSecurityHint(n,t))):(this.flipCardIfNeeded(n,t),void this.showSecurityHint(n,t))},updateDocumentContainer:function(e){this.documentContainerView.setDocumentComponentByType(e)},getCardNumberFormat:function(){var e=this.options.cardModel.get("brand").split("_")[0],n=t.channels.cho.request("payments:binHelper").card_number_length;return"maestro"!==e&&"master"!==e||(e+="&"+n),this.options.cardModel.set("brand",e),e&&this.cardContainerView.cardComponent.interactions[e]?this.cardContainerView.cardComponent.interactions[e].format:this.cardContainerView.cardComponent.interactionDefault.format},newCardAnimation:function(e,t,n){return new TweenLite.to(this.cardContainerView.$el,e,{y:t,paused:!0,ease:n})}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o,s){e.SplitPaymentDetail=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._splitPayment,'[data-component="split-payment"]')},className:function(){var e="split-payment-list__item",n=t.Config.device;return"mobile"!==n?e:e.concat(" ui-list-card")},tagName:function(){return this.options.containerTagName||"article"},regions:{paymentDetailHeader:'[data-js="payment-detail-header"]',installmentSelection:'[data-js="installment-selection"]'},onShow:function(){this.dataConfig=this.getDataConfig(),this.renderPaymentDetailHeader(),this.renderAdequateInstallmentView()},getDataConfig:function(){var e=t.channels.flow.request("step:data"),n=e.inputs.installmentsSelection.data.installmentsSelection;n||t.Checkout.ErrorService["throw"](new MissingDataError({method:"getDataConfig()",missingKey:"installmentsSelection",context:this,type:MissingDataError.type.INPUT,reason:"Missing installments selection data",severity:t.Checkout.ErrorService.severity.WARNING}));var i=s.findWhere(n,{paymentId:this.model.get("paymentId")});return{stepData:e,currentPaymentInstallments:i,currentPaymentData:this.model.toJSON()}},renderAdequateInstallmentView:function(){this.hasSelectedInstallment()?this.renderInstallmentView():this.renderSelectInstallmentView()},getInstallmentModel:function(){return this.dataConfig.currentPaymentData.selectedInstallment},getChevronClasses:function(){return"ui-icon--chevron--right"},renderInstallmentView:function(){this.getRegion("installmentSelection").show(new t.Checkout.Payments.Views.Installment({model:new t.Checkout.Payments.Models.Installment(this.getInstallmentModel()),withoutFeeText:this.dataConfig.stepData.data.upperWithoutFeeText,singleOptionView:!0,withoutFee:this.dataConfig.currentPaymentData.withoutFee,showChevron:!0,chevronClasses:this.getChevronClasses(),onSubmit:this.getSelectInstallmentSubmitHandler(),onSubmitConfig:this.dataConfig,tagName:"div"}))},getSelectInstallmentSubmitHandler:function(){return this.renderPaymentEditModal.bind(this)},renderSelectInstallmentView:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.disableViewTracking,i=void 0===n?!1:n;this.getRegion("installmentSelection").show(new t.Checkout.Payments.Views.SelectInstallment({selectionMessageText:this.dataConfig.stepData.data.selectionMessageText,withoutFeeText:this.dataConfig.stepData.data.lowerWithoutFeeText,withoutFee:this.dataConfig.currentPaymentData.withoutFee,onSubmit:this.getSelectInstallmentSubmitHandler(),onSubmitConfig:this.dataConfig,disableViewTracking:i}))},hasSelectedInstallment:function(){return this.model.get("selectedInstallment")},getPaymentDetailHeaderOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:48;return{model:new t.Checkout.Payments.Models.PaymentDetailHeader(this.dataConfig.currentPaymentData),upperWithoutFeeText:this.dataConfig.stepData.data.upperWithoutFeeText,onSubmit:this.renderPaymentDetailsModal.bind(this),onSubmitConfig:this.dataConfig,imagesWidth:e,imagesHeight:e}},renderPaymentDetailHeader:function(){this.getRegion("paymentDetailHeader").show(new t.Checkout.Payments.Views.PaymentDetailHeader(this.getPaymentDetailHeaderOptions(this.headerImageSize)))},showInModal:function(e){t.channels.core.trigger("modal:open",{childView:new t.Checkout.Views.ContentWrapper(e),isInterceptedClose:!0})},renderPaymentDetailsModal:function(){var e=new t.Checkout.Payments.Views.ItemsDetailsHeader({model:new t.Checkout.Payments.Models.ItemsDetailsHeader(this.dataConfig.currentPaymentData),withoutFeeText:this.dataConfig.stepData.data.upperWithoutFeeText}),n=this.dataConfig.currentPaymentData.items.slice(0);this.dataConfig.currentPaymentData.totalShippingCost&&n.push({totalShippingCostText:this.dataConfig.stepData.data.totalShippingCostText,totalShippingCost:this.dataConfig.currentPaymentData.totalShippingCost});var i=new t.Checkout.Views.ItemsDetailsList({collection:new t.Checkout.Collections.ItemsDetailsList(n)});this.showInModal({containerClass:"ui-list--modal payment-detail-modal",headerView:e,headerClass:"ui-list ui-list--modal ui-list__header",contentView:i,contentClass:"ui-list ui-list__content"},"splitPaymentDetails")},getInstallmentsCollectionView:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.disableViewTracking,i=void 0===n?!1:n,o=this.dataConfig.currentPaymentInstallments.installmentsOptions;o||t.Checkout.ErrorService["throw"](new MissingDataError({method:"getInstallmentsCollectionView()",missingKey:"installmentsOptions",context:this,type:MissingDataError.type.DATA,reason:'Cannot render installments view without "installmentsOptions" value',severity:t.Checkout.ErrorService.severity.WARNING}));var s={collection:new t.Checkout.Payments.Collections.Installments(o),withoutFeeText:this.dataConfig.stepData.data.upperWithoutFeeText,withoutFee:this.dataConfig.currentPaymentData.withoutFee,paymentId:this.dataConfig.currentPaymentData.paymentId,disableViewTracking:i};return this.getInstallmentsListChevronConfig(s),new t.Checkout.Payments.Views.Installments(s)},getInstallmentsListChevronConfig:function(e){e.showChevron=!1,e.showChevronIfSelected=!1},renderPaymentEditModal:function(){var e=new t.Checkout.Payments.Views.PaymentDetailHeader({model:new t.Checkout.Payments.Models.PaymentDetailHeader(this.dataConfig.currentPaymentData)});this.showInModal({containerClass:"ui-list--modal",headerView:e,headerClass:"ui-list ui-list--modal",contentView:this.getInstallmentsCollectionView(),contentClass:"ui-list ui-list__content"},"splitInstallments")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o,s){e.PaymentTypeLayout=i.LayoutView.extend({filePath:"src/scripts/modules/payments/views/payment-type.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.payments,'[data-component="select-type-payment"]')},ui:{heading:'[data-js="stepTitle-heading"]',footer:'[data-js="footer"]',cartContent:".cart-content",discountButton:'[data-js="discount-button"]',switchRegion:'[data-js="ui-switch"]',stepTitleLink:'[data-js="step-title-link"]'},events:{"click @ui.discountButton":"displayDiscountMessage"},regions:{footerRegion:"@ui.footer",switchRegion:"@ui.switchRegion"},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["beginSave","iframeLoading","showSpinner"],hideOn:["flowSaved","iframeLoaded"],timeout:9e3},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["bankDeals"],trackIfPresent:!0},BankDeals:{behaviorClass:t.Behaviors.BankDeals}}},onShow:function(){this.registerCollections(),this.checkAccountMoneyData(),this.focusHeading()},focusHeading:function(){this.ui.heading.focus()},registerCollections:function(){this.paymentsCollectionViews=[];var e=new t.Checkout.Payments.Collections.PaymentTypesCollection(this.options.storedCardData),n=new t.Checkout.Payments.Collections.PaymentTypesCollection(this.options.paymentTypesData),i=new t.Checkout.Payments.Collections.PaymentTypesCollection(this.options.externalWalletsData);this.registerCollectionView(e,"storedPaymentTypes"),this.registerCollectionView(n,"paymentsTypesRegion"),this.registerCollectionView(i,"externalWalletsRegion")},registerCollectionView:function(t,n){var i=this;if(t&&t.length){var o=new e.PaymentTypesList({inputs:this.model.get("inputs"),collection:t});this.getRegion(n).show(o),this.onRadioClick&&o.on("radioClick",function(){return i.onRadioClick(o)}),this.paymentsCollectionViews.push(o)}},checkAccountMoneyData:function(){var e=this.model.get("data").accountMoneyContext;e&&this.renderSwitch(e)},renderSwitch:function(e){if("boolean"!=typeof e.useAccountMoney)return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"renderSwitch()",missingKey:"useAccountMoney",context:this,type:MissingDataError.type.DATA,reason:'Cannot set switch state without "useAccountMoney" value',severity:t.Checkout.ErrorService.severity.WARNING}));var i=new t.Checkout.Views.Switch({model:new n.Model({data:{value:e.useAccountMoney}})});this.getRegion("switchRegion").show(i),i.on("change",this.handlerSwichViewChanged.bind(this))},handlerSwichViewChanged:function(e){var n=this;this.trigger("beginSave"),this.trackSwitchChanged(e),t.channels.flow.trigger("output:add",{key:"useAccountMoney",value:e}),t.channels.flow.once("saved",function(){n.trigger("flowSaved"),t.Checkout.Payments.isUsingAccountMoney=e}),t.channels.flow.trigger("save")},trackSwitchChanged:function(e){var n=this.options.model.get("inputs").useAccountMoney.data,i=n?n.events[0]:null;if(i){var o=e?"USE":"NOT_USE";i.ga.label=o,i.melidata.path+=("/"+o).toLowerCase(),t.Track.analyticsEvent(i.ga),t.Track.melidataEvent(i.melidata)}},showInModal:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;t.channels.core.trigger("modal:open",{childView:new t.Checkout.Views.ContentWrapper(e),isClosable:n,isInterceptedClose:i})},displayDiscountMessage:function(){var e=this.model.get("data").footer.discount;if(!e)return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"displayDiscountMessage()",missingKey:"footer.discount",context:this,type:MissingDataError.type.DATA,reason:"Cannot display message without discount data",severity:t.Checkout.ErrorService.severity.WARNING}));var i=new n.Model(e),o=new t.Checkout.Views.ModalMessage({model:i});t.channels.core.trigger("modal:close"),this.showInModal({contentView:o,className:"ui-list ui-list--modal ui-list--modal--discounts"})},buildConfirmModalView:function(e){var i=new n.Model(e),o=new t.Checkout.Views.ModalMessage({model:i,className:"modal-message-container"});return o.once("modal:userAction:continue",this.continueWithoutAmOm.bind(this)),o.once("modal:userAction:pay_with_another_pm",this.cancelSave.bind(this)),o},continueWithoutAmOm:function(){this.submitValues.accountMoneyData.useAccountMoney=!1,t.channels.core.trigger("modal:close"),this.send(this.submitValues)},cancelSave:function(){t.channels.core.trigger("modal:close")},showConfirmModal:function(e){var n=t.channels.core.request("modal:isOpen");n&&t.channels.core.trigger("modal:close"),this.inconsistenceViewModalView=this.buildConfirmModalView(e),t.channels.core.trigger("modal:open",{childView:new t.Checkout.Views.ContentWrapper({contentView:this.inconsistenceViewModalView,contentClass:"content-wrapper-content--no-scroll"}),isClosable:!0,isInterceptedClose:!0})},showConfirmIfNeeded:function(){var e=this.model.get("data"),t=this.submitValues.type,n=this.submitValues.cardId,i=e.types;e.storedCards&&(i=i.concat(e.storedCards));var o=i.filter(function(e){return e.type===t&&e.cardId==n});o&&o[0].metadata?this.showConfirmModal(o[0].metadata):this.send(this.submitValues)},trackOptionSelected:function(e){if(e.trackInfo){var n=e.trackInfo;t.Track.analyticsEvent(n.ga),t.Track.melidataEvent(n.melidata)}},send:function(e){var n=this;this.trackOptionSelected(e),this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:this.model.get("inputs").paymentTypeSelection.output,value:e.type}),e.id&&t.channels.flow.trigger("output:add",{key:this.model.get("inputs").paymentMethodIdSelection.output,value:e.id}),e.groupId&&t.channels.flow.trigger("output:add",{key:this.model.get("inputs").paymentMethodSelection.output,value:e.groupId}),e.cardId&&t.channels.flow.trigger("output:add",{key:this.model.get("inputs").paymentCardIdSelection.output,value:e.cardId}),e.accountMoneyData&&t.channels.flow.trigger("output:add",{key:"useAccountMoney",value:e.accountMoneyData.useAccountMoney}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),e.cardId?this.callGatewayIfNeededAndSave(e.cardId):t.channels.flow.trigger("save")},callGatewayIfNeededAndSave:function(e){var n=this,i=this.model.get("data.storedCards")||[],o=s.findWhere(i,{cardId:parseInt(e,10)})||{},a=o.callGatewayIsRequired,r={sessionId:t.Config.escId,requireEsc:this.model.get("data.requireEsc")||a,gatewayUri:this.model.get("data.gatewayUri"),gatewayPublicKey:this.model.get("data.gatewayPublicKey")},d=new t.Checkout.ESC(r),l=function(e){t.channels.flow.trigger("output:add",{key:n.model.get("inputs").tokenList.output,value:e.tokenList}),t.channels.flow.trigger("save")},u=function(){t.channels.flow.trigger("save")};d.on("succeeded",l),d.on("failed",u),d.getCardToken({cardId:o.cardId,lastFourDigits:o.lastFourDigits,firstSixDigits:o.firstSixDigits,requiredTokens:o.token_count,tokenList:o.tokenList,callGatewayIsRequired:o.callGatewayIsRequired,selectedPayment:{type:o.type,id:o.id,issuerId:o.issuerId,issuerName:o.issuerName}})}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.PaymentSplit=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.paymentSplit,'[data-component="payment-split"]')},regions:{summaryComponent:'[data-js="summary-component"]',splitPaymentsList:'[data-js="split-payments-list"]'},ui:{summaryForm:'[data-component="summary-component"] form',selectInstallment:'[data-js="select-installment"]'},events:{"submit @ui.summaryForm":"send","click @ui.selectInstallment":"removeAnimation"},templateHelpers:function(){return{hasInstallmentsSelected:0===this.checkNotSelectedInstallment().count}},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},renderSummaryComponent:function(){var e=this.model.get("data");this.summaryComponentView=new t.Checkout.Views.SummaryComponent({model:new t.Checkout.Models.FooterComponent({dataFooter:e.footer}),actionButton:!0,buttonText:e.stepContext.submitButtonText,disabled:!1}),this.getRegion("summaryComponent").show(this.summaryComponentView)},renderSplitPaymentsList:function(){this.getRegion("splitPaymentsList").show(new t.Checkout.Payments.Views.SplitPaymentsList({
collection:new t.Checkout.Payments.Collections.SplitPaymentsList(this.model.get("data").payments)}))},checkNotSelectedInstallment:function(){var e=this.model.get("data").payments,t=void 0,n=0;return e.forEach(function(e){e.selectedInstallment||(n+=1,t||(t=e))}),{installment:t,count:n}},focusInstallment:function(e,t,n){var i=$('[data-payment-id="'+e.installment.paymentId+'"]');TweenLite.to($("body, html"),t,{scrollTop:i.offset().top,ease:Power2.easeInOut,onComplete:n,onCompleteParams:[i,e]})},addCircleAnimation:function(e){var t=e.find(".select-installment__chevron"),n=t.clone(!0);t.removeClass("select-installment__chevron-animate"),t.before(n).remove(),n.addClass("select-installment__chevron-animate")},removeAnimation:function(e){var t=$(e.currentTarget).find(".select-installment__chevron");t.removeClass("select-installment__chevron-animate")},onShow:function(){this.renderSplitPaymentsList(),this.renderSummaryComponent()},send:function(e){var n=this;e.preventDefault();var i=this.model.get("data");i.installmentsReady?(this.trigger("beginSave"),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")):this.focusInstallment(this.checkNotSelectedInstallment(),.3,this.addCircleAnimation.bind(this))}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.PaymentMethodsLayout=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.paymentMethods,'[data-component="payment-method"]')},ui:{paymentMethodsRegion:'[data-js="payment-methods"]',hero:'[data-component="hero"]'},regions:{paymentMethods:"@ui.paymentMethodsRegion",hero:"@ui.hero"},onShow:function(){this.renderPaymentMethods()},renderPaymentMethods:function(){this.paymentMethodsView=new e.PaymentMethodsList({collection:this.collection,output:this.model.get("inputs").paymentMethodSelection.output}),this.getRegion("paymentMethods").show(this.paymentMethodsView)}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.InstallmentsLayout=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.installments,'[data-component="installments"]')},ui:{cardContainer:'[data-js="card-container"]',installmentsList:'[data-js="installments-list"]',hero:'[data-component="hero"]'},regions:{cardContainer:"@ui.cardContainer",installmentsList:"@ui.installmentsList",hero:"@ui.hero"},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}},renderCardComponentIfNeeded:function(){var n=this.model.get("data").selectedCard,i=this.model.get("data").selectedPayment;if(n&&i){!n.id&&t.Checkout.Payments.binHelper&&(n.id=t.Checkout.Payments.binHelper.payment_method_id);var o=n.id;i&&(o+="_"+i.issuerName);var s=new t.Checkout.Payments.Models.Card({brand:o,cardNumber:"************"+n.lastFourNumbers,cardSize:9}),a=new e.CardContainer({model:s});this.getRegion("cardContainer").show(a)}},onShow:function(){this.renderCardComponentIfNeeded(),this.renderInstallmentsList()},renderInstallmentsList:function(){var e="installmentsSelection",n=_.first(t.channels.flow.request("input:get",{name:e}).data[e]);if(!n)return t.Checkout.ErrorService["throw"](new MissingInstallmentsDataError({context:this,binNumber:t.Checkout.Payments.binHelper?t.Checkout.Payments.binHelper.firstSixDigits:"",cardId:t.Checkout.Payments.cardId})),void t.channels.cho.trigger("app:fatalError");var i=new t.Checkout.Payments.Collections.Installments(n.installmentsOptions);this.installmentsCollectionView=new t.Checkout.Payments.Views.Installments({collection:i,withoutFeeText:this.model.get("data").withoutFeeText,isModalView:!1}),this.getRegion("installmentsList").show(this.installmentsCollectionView)}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o,s){e.CardForm=i.LayoutView.extend({filePath:"src/scripts/modules/payments/views/card-form.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.cardForm,'[data-component="new-card"]')},ui:{cardContainer:'[data-js="card-container"]',formContainer:'[data-js="card-form-container"]',userIdentificationNumber:'[data-input-id="userIdentificationNumber"]'},regions:{cardContainer:"@ui.cardContainer"},behaviors:function a(){var e=this.getStepInputs(),a={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,isNavigable:!0,hasCard:!0,submitButtonText:this.options.model.get("data").stepContext.submitButtonText,inputs:e},BinHelper:{behaviorClass:t.Checkout.Behaviors.NewCard},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:["beforeDestroy","invalidDataFound"]},Biometrics:{behaviorClass:t.Checkout.Behaviors.Biometrics,keyboardForm:'[data-component="new-card"] form[data-js="form-container"]',keyboardSensitive:'input[name="card_number"], input[name="expiration_date"], input[name="security_code"]'}};return window.requestAnimationFrame||(a.FormatlessPaste={behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["cardNumber","expirationDate","userIdentificationNumber"],validMaskRegex:/[^0-9]/g}),a},onFormSubmit:function(){this.handleSubmit()},handleSubmit:function(){this.isFormValid()&&(this.model.get("data").keystrokeUri&&this.handleKeystrokeRequest(),this.trigger("beginSave"),this.triggerMethod("callGateway",this.getNewCardBehaviorOptions()),this.triggerMethod("setConditionAsMet","clickedSubmit"))},handleKeystrokeRequest:function(){this.keystrokeModel.save()},getStepInputs:function(){var e=t.channels.flow.request("step:data").inputs;return e.expirationDate&&"hidden"!==e.expirationDate.type&&this.injectExpirationDateConstraint(e),e},injectExpirationDateConstraint:function(e){var n=e.expirationDate;if(!n||s.isEmpty(n))return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"injectExpirationDateConstraint()",missingKey:"expirationDate",context:this,type:MissingDataError.type.INPUT,reason:"Cannot set expiration date constraint without expirationDate data",severity:t.Checkout.ErrorService.severity.WARNING}));if(!this.inputDataHasConstraints(n))return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"injectExpirationDateConstraint()",missingKey:"data.constraints",context:this,type:MissingDataError.type.INPUT,reason:"Cannot set expiration date constraint without constraints data",severity:t.Checkout.ErrorService.severity.WARNING}));var i=null;i=s.findWhere(n.data.constraints,{name:"pattern"}),n.data.constraints.push({name:"pastDate",errorMessage:i.errorMessage}),n.data.constraints.push({name:"validDate",errorMessage:i.errorMessage})},inputDataHasConstraints:function(e){return e&&e.data&&Array.isArray(e.data.constraints)},setStoredCardBrand:function(e){var n=e.paymentMethodId;return n?(e.selectedPayment&&e.selectedPayment.issuerName?n+="_"+e.selectedPayment.issuerName:t.Checkout.ErrorService["throw"](new MissingDataError({method:"setStoredCardBrand()",missingKey:"selectedPayment || selectedPayment.issuerName",context:this,type:MissingDataError.type.DATA,reason:"Cannot set storedCard issuer without selectedPayment or issuerName",severity:t.Checkout.ErrorService.severity.WARNING})),void this.cardModel.set("brand",n)):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"setStoredCardBrand()",missingKey:"paymentMethodId",context:this,type:MissingDataError.type.DATA,reason:"Cannot set storedCard brand without paymentMethodId",severity:t.Checkout.ErrorService.severity.WARNING}))},onInputValueChanged:function(e){var t=e.model,n=t.get("id");if("userIdentificationNumber"===n){var i=t.get("data.value");this.documentModel.set("number",i)}else"cardNumber"===n?(this.updateRemoteConstraint(t),this.handleCardNumberFormat(e),this.updateCardNumberMaxLength(),this.callBinHelper()):"expirationDate"===n?this.handleInputExpirationDate(e):this.setCardComponentData(n,t.get("data.value"))},handleKeystrokeValidation:function(){var e=t.channels.flow.request("attribute:get",{name:"userId"}),n=this.model.get("data").keystrokeUri,i=this.getInputCollection().filter(function(e){return e.isNavigable()});i.length<1&&t.Checkout.ErrorService["throw"](new MissingDataError({method:"handleKeystrokeValidation()",missingKey:"visibleInputs",context:this,type:MissingDataError.type.INPUT,reason:"No inputs were found to apply keystroke validation",severity:t.Checkout.ErrorService.severity.WARNING})),this.keystrokeModel=new t.Checkout.Payments.Models.Keystroke({user_id:e},n),i.forEach(this.applyKeystrokeHandler.bind(this))},applyKeystrokeHandler:function(e){var t=this,n=this.getInputViewByModel(e),i=this.getInputDOMElement(n),o=e.get("data.keystrokeFieldName");i.on("paste",function(){t.logPasteToKeystroke(o)})},logPasteToKeystroke:function(e){var t=this.keystrokeModel.get(e+".time");this.keystrokeModel.get(e+".shortcut")?(t+=1,this.keystrokeModel.set(e+".time",t)):(this.keystrokeModel.set(e+".shortcut",!0),t+=1,this.keystrokeModel.set(e+".time",t))},onFormShown:function(){this.model.get("data").keystrokeUri&&this.handleKeystrokeValidation(),this.initializeCardForm(),this.handleStoredCardIfNeeded(),window.requestAnimationFrame||(this.useExpirationDateWithoutSpaces(),this.setFormatlessHints())},useExpirationDateWithoutSpaces:function(){var e=this.getInputModelById("expirationDate");e.changeConstraintValue("pattern","\\d{4}"),e.changeConstraintValue("minLength",4),e.changeConstraintValue("maxLength",4)},setFormatlessHints:function(){var e=this,t=this.model.get("data"),n=["cardNumber","expirationDate"];this.getInputModelById("userIdentificationNumber")&&n.push("userIdentificationNumber"),n.forEach(function(n){e.getInputModelById(n).set("data.prompt",t.newCardContext.writeOnlyNumbers)})},handleStoredCardIfNeeded:function(){if(this.isOnlySecurityCodeStep()){var e=this.model.get("data");this.setStoredCardBrand(e),this.configureStoredCardOwnerName(e),this.configureStoredCardNumber(e),this.configureStoredCardExpirationDate(e)}},onShow:function(){this.bindEvents()},initializeCardForm:function(){this.setUiCards()},setUiCards:function(){this.setCreditCardData();var t=this.model.get("inputs");t.userIdentificationNumber&&t.userIdentificationType&&!this.isOnlySecurityCodeStep()&&this.setDocumentData(),this.uiCardsView=new e.UiCards({documentModel:this.documentModel,documentContext:this.documentContext,cardModel:this.cardModel}),this.getRegion("cardContainer").show(this.uiCardsView)},setDocumentData:function(){if(this.documentContext=this.model.get("data").newCardContext,!this.documentContext)return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"setDocumentData()",missingKey:"newCardContext",context:this,type:MissingDataError.type.DATA,reason:"Unable to render document component because newCardContext data was missing",severity:t.Checkout.ErrorService.severity.WARNING}));var e=this.model.get("inputs");this.documentModel=new t.Checkout.Payments.Models.Document({number:null,type:e.userIdentificationType?e.userIdentificationType.data.value:null})},setCreditCardData:function(){var e=this.model.get("data");this.cardModel=t.Checkout.Payments.cardData||new t.Checkout.Payments.Models.Card,this.setCardComponentData("cardSize",this.cardSize),e&&e.newCardContext&&this.setCardComponentData("ownerNamePlaceholder",e.newCardContext.ownerNamePlaceholder)},bindEvents:function(){this.on("input:value:changed",this.onInputValueChanged.bind(this)),this.on("input:focus",this.onInputFocus.bind(this)),this.on("input:remove",this.onInputRemove.bind(this)),this.on("input:autocomplete",this.onInputAutocomplete.bind(this)),this.on("input:select:change",this.onInputSelectChange.bind(this)),this.triggerMethod("initializeFlowConditions",this.getNewCardBehaviorOptions()),this.on("binHelperSuccessful",this.onBinHelperSuccessful.bind(this)),this.on("binHelperInvalid",this.onBinHelperInvalid.bind(this)),this.on("invalidDataFound",this.onInvalidDataFound.bind(this)),this.on("formShown",this.onFormShown.bind(this)),this.on("formComplete",this.onFormSubmit.bind(this)),this.on("input:pastedWithoutFormat",this.onInputValueChanged.bind(this))},onUpdateInputsConstraints:function(e){Array.isArray(e)&&e.forEach(this.updateInputConstraints.bind(this))},updateInputConstraints:function(e){var n=e.id,i=e.mustValidate;if(n&&"boolean"==typeof i){var o=this.getInputModelById(n),s=t.channels.flow.request("input:get",{name:n});if(!s)return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"updateInputConstraints()",missingKey:"newInputData",context:this,type:MissingDataError.type.INPUT,reason:"Unable to get newInputData input from data",severity:t.Checkout.ErrorService.severity.WARNING}));o.set("data.constraints",s.data.constraints,{validate:!1});var a=o.get("data.value");i&&a&&a.length&&a.length>0&&o.isValid()}},showInputValidation:function(e){var t=this.getInputModelById(e),n=t.get("error")||t.get("data.defaultError");if(!n){var i=t.getConstraint("pattern");i&&i.errorMessage&&(n=i.errorMessage)}t.set("error",n),this.handleErroredInput(e)},handleErroredInput:function(e){this.navigateTo(e)},onInvalidDataFound:function(e){this.showInputValidation(e)},onBinHelperSuccessful:function(){this.applyLuhnValidationConstraint();var e=this.getInputModelById("cardNumber"),t=this.getInputViewByModel(e);this.handleCardNumberFormat(t),this.updateCardNumberMaxLength(),this.updateCardNumberCheckDigit(),this.updateCardNumberPattern(),this.updateSecurityCodeModel(),e.validate(),e.removeConstraint("invalidRemoteConstraint",!0)},onBinHelperInvalid:function(){var e=t.channels.flow.request("step:data"),n=this.getInputModelById("cardNumber");n.addConstraint({name:"invalidRemoteConstraint",errorMessage:e.inputs.cardNumber.error},!0),this.triggerMethod("cardNumberInvalid")},onCardNumberInvalid:function(){this.showInputValidation("cardNumber"),this.appendNonEqualInputConstraint("cardNumber")},appendNonEqualInputConstraint:function(e){var t=this.getInputModelById(e);t.addConstraint({name:"nonEquals",value:t.get("data.value"),errorMessage:t.get("data.error")})},onInputFocus:function(e){this.flipCardIfNeeded(this.getInputDOMElement(e))},onInputRemove:function(e,t){var n=e.model,i=n.get("data.value"),o=n.get("id");i&&"expirationDate"===o&&this.handleRemoveExpirationDate(e,t)},onInputAutocomplete:function(e){var t=e.model,n=t.get("id");"expirationDate"===n&&this.handleAutocompleteExpirationDate(e)},onInputSelectChange:function(e){this.uiCardsView.cardAnimation.play(),this.uiCardsView.DocumentAnimation.play();var t=e.model.get("data.value"),n=t.toLowerCase();this.documentModel.set("number",""),this.uiCardsView.updateDocumentContainer(n)},flipCardIfNeeded:function(e){this.uiCardsView.updateCards(e)},handleAutocompleteExpirationDate:function(e){this.handleInputExpirationDate(e)},handleInputExpirationDate:function(e){var t=e.model,n=" / ",i=t.get("data.value")||"",o=i.replace(/\//,"").replace(/ /g,""),s=o.replace(/(\d{2})(\d{1,4})/,"$1"+n+"$2");s=2===s.length||5===s.length?""+s+n:s;var a=o.replace(/(\d{2})(\d{1,4})/,function(e,t,i){return""+t+n.replace(/ /g,"")+i.slice(-2)});this.setModelExpirationDate(t,s,a)},handleRemoveExpirationDate:function(e,t){var n=e.model,i=n.get("data.value")||"";if(i.match(/ \/ $/)){var o=i.replace(/\//,"").replace(/ /g,"");this.setModelExpirationDate(n,o,o),t.preventDefault()}},setModelExpirationDate:function(e,t,n){var i=this,o=e.getConstraint("maxLength"),s=o.value-2,a=function(){e.set("data.value",t),i.setCardComponentData("expirationDate",n),t.length>=s&&e.isValid()};return window.requestAnimationFrame?void window.requestAnimationFrame(a):void a()},configureStoredCardOwnerName:function(e){var t="ownerName",n=this.getInputModelById(t);this.setCardComponentData(t,e.cardHolderName),n.set("data.value",e.cardHolderName)},configureStoredCardNumber:function(e){var t=this.getInputModelById("cardNumber"),n=this.getInputViewByModel(t),i=e.lastFourDigits.toString(),o=Array(this.getCardNumberFormatLength(!1)-i.length+1).join("*"),s=o+i;t.set("data.value",s),this.handleCardNumberFormat(n)},configureStoredCardExpirationDate:function(e){var t=e.expirationMonth.toString(),n=e.expirationYear.toString(),i=Array(2-t.length+1).join("0")+t,o=n.substr(2,2),s=i+o;this.setCardComponentData("expirationDate",s)},getCardNumberFormatLength:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0,t=this.uiCardsView.getCardNumberFormat().split("-");return t.map(function(e){return Number(e)}).reduce(function(e,t){return e+t})+(e?t.length-1:0)},handleCardNumberFormat:function(e){var t=this,n=e.model,i=n.get("data.value"),o=i.replace(/ /g,"");if(!window.requestAnimationFrame)return void this.setCardComponentData("cardNumber",o);var a=this.uiCardsView.getCardNumberFormat(),r=a.split("-").map(function(e,t){var i=t>0?"?":"",o=n.getAttribute("readOnly"),s=o&&o.name;return s?"(\\d{"+e+"})"+i:"(\\d{"+e+"}|\\*{"+e+"})"+i}),d=new RegExp(r.join(""),"g"),l=d.exec(o),u=Math.min(r.length,l?l.filter(function(e){return void 0!==e}).length:0),c=s.range(1,u+1).map(function(e){return"$"+e}).join(" "),h=o.replace(d,c);window.requestAnimationFrame(function(){t.setCardComponentData("cardNumber",o),n.set("data.value",h.trim())})},updateCardNumberMaxLength:function(){var e=this.getInputModelById("cardNumber"),t=!!window.requestAnimationFrame,n=this.getCardNumberFormatLength(t);e.updateConstraint({constraintName:"minLength",value:n}),e.updateConstraint({constraintName:"maxLength",value:n})},updateCardNumberCheckDigit:function(){var e=this.getInputModelById("cardNumber"),n=t.channels.flow.request("step:data"),i=n.inputs.cardNumber.data;i.constraints.map(function(t){if("checkDigit"===t.name){var n=!0;e.addConstraint(t,n)}return!0})},updateCardNumberPattern:function(){var e=this.getInputModelById("cardNumber"),n=t.channels.flow.request("step:data"),i=n.inputs.cardNumber.data;i.constraints.map(function(t){return"pattern"===t.name&&e.updateConstraint({constraintName:"pattern",errorMessage:t.errorMessage,value:t.value}),!0})},setCardComponentData:function(e,t){this.cardModel.set(e,t)},updateRemoteConstraint:function(e){var t=e.get("data.value");t&&t.replace(/ /g,"").length<6&&e.removeConstraint("invalidRemoteConstraint",!1)},callBinHelper:function(){var e=this.getInputModelById("cardNumber").get("data.value").replace(/\s/g,"");this.setCardComponentData("cardNumber",e),this.triggerMethod("callBinHelper",this.getNewCardBehaviorOptions())},getNewCardBehaviorOptions:function(){var e=t.channels.flow.request("step:data").inputs,n=e.first_six_digits;return n||t.Checkout.ErrorService["throw"](new MissingDataError({method:"getNewCardBehaviorOptions()",missingKey:"first_six_digits",context:this,type:MissingDataError.type.INPUT,reason:"Unable to get first_six_digits input from data",severity:t.Checkout.ErrorService.severity.WARNING})),{firstSixDigitsInput:n,stepData:this.model.get("data"),cardModel:this.cardModel,documentModel:this.documentModel,onlySecurityCode:this.isOnlySecurityCodeStep()}},isOnlySecurityCodeStep:function(){return"newCardSecurityCode"===this.options.stepType},applyLuhnValidationConstraint:function(){var e=this.getInputModelById("cardNumber"),n=t.channels.cho.request("payments:binHelper");e.removeConstraint("luhn",!1),"STANDARD"===n.card_number_validation&&e.addConstraint({name:"luhn",value:n.card_number_length,errorMessage:e.get("data.defaultError")},!1)},updateSecurityCodeModel:function(){var e=t.channels.flow.request("step:data"),n=e.inputs.securityCode;return n?void this.getInputModelById("securityCode").set("data",n.data):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"updateSecurityCodeModel()",missingKey:"securityCode",context:this,type:MissingDataError.type.INPUT,reason:"Unable to get securityCode input from data",severity:t.Checkout.ErrorService.severity.WARNING}))}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o,s){e.ExpiredEscSecurityCode=i.LayoutView.extend({filePath:"src/scripts/modules/payments/views/expired-esc-security-code.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.expiredEscSecurityCode,'[data-component="expired-esc]')},ui:{cardContainer:'[data-js="card-container"]',formContainer:'[data-js="card-form-container"]',userIdentificationNumber:'[data-input-id="userIdentificationNumber"]',changePayment:'[data-js="change-payment"]',confirmButton:'[data-id="overview-action"]'},events:{"click @ui.confirmButton":"onFormSubmit","click @ui.changePayment":"changePayment"},regions:{cardContainer:"@ui.cardContainer"},behaviors:function a(){var e=this.getStepInputs(),n=this.options.model.get("data").stepContext,a={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,isNavigable:!1,hasCard:!0,hideSubmitButton:!0,formId:"expired-esc-form",submitButtonText:this.options.model.get("data").stepContext.submitButtonText,inputs:e},BinHelper:{behaviorClass:t.Checkout.Behaviors.NewCard,hasToRedirect:!1},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:["beforeDestroy","invalidDataFound"]},Biometrics:{behaviorClass:t.Checkout.Behaviors.Biometrics,keyboardForm:'[data-component="expired-esc"] form[data-js="form-container"]',keyboardSensitive:'input[name="card_number"], input[name="expiration_date"], input[name="security_code"]'}};return window.requestAnimationFrame||(a.FormatlessPaste={behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["cardNumber","expirationDate","userIdentificationNumber"],validMaskRegex:/[^0-9]/g}),n&&(a.AnimationReviewCongrats={behaviorClass:t.Behaviors.AnimationReviewCongrats,transitionText:n.loadingButtonText,confirmText:n.submitButtonText,hasToSave:!1}),a},initialize:function(){this.bindEvents();var e=this.model.get("data"),n=e.requireEsc,i=e.lastFourDigits,o=e.firstSixDigits,s=e.cardId;new t.Checkout.ESC({requireEsc:n,sessionId:t.Config.escId}).removeStoredEscForCard({lastFourDigits:i,firstSixDigits:o,cardId:s})},onFormSubmit:function(e){e.preventDefault(),this.handleSubmit()},handleSubmit:function(){this.isFormValid()&&(this.model.get("data").keystrokeUri&&this.handleKeystrokeRequest(),this.triggerMethod("callGateway",this.getCardBehaviorOptions()),this.triggerMethod("setConditionAsMet","clickedSubmit"),this.triggerMethod("send"))},handleKeystrokeRequest:function(){this.keystrokeModel.save()},getStepInputs:function(){return t.channels.flow.request("step:data").inputs},setStoredCardBrand:function(e){var n=e.paymentMethodId;return n?(e.selectedPayment&&e.selectedPayment.issuerName?n+="_"+e.selectedPayment.issuerName:t.Checkout.ErrorService["throw"](new MissingDataError({method:"setStoredCardBrand()",missingKey:"selectedPayment || selectedPayment.issuerName",context:this,type:MissingDataError.type.DATA,reason:"Cannot set storedCard issuer without selectedPayment or issuerName",severity:t.Checkout.ErrorService.severity.WARNING})),void this.cardModel.set("brand",n)):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"setStoredCardBrand()",missingKey:"paymentMethodId",context:this,type:MissingDataError.type.DATA,reason:"Cannot set storedCard brand without paymentMethodId",severity:t.Checkout.ErrorService.severity.WARNING}))},onInputValueChanged:function(e){var t=e.model,n=t.get("id");this.setCardComponentData(n,t.get("data.value"))},handleKeystrokeValidation:function(){var e=t.channels.flow.request("attribute:get",{name:"userId"}),n=this.model.get("data").keystrokeUri,i=this.getInputCollection().filter(function(e){return e.isNavigable()});i.length<1&&t.Checkout.ErrorService["throw"](new MissingDataError({method:"handleKeystrokeValidation()",missingKey:"visibleInputs",context:this,type:MissingDataError.type.INPUT,reason:"No inputs were found to apply keystroke validation",severity:t.Checkout.ErrorService.severity.WARNING})),this.keystrokeModel=new t.Checkout.Payments.Models.Keystroke({user_id:e},n),i.forEach(this.applyKeystrokeHandler.bind(this))},applyKeystrokeHandler:function(e){var t=this,n=this.getInputViewByModel(e),i=this.getInputDOMElement(n),o=e.get("data.keystrokeFieldName");i.on("paste",function(){t.logPasteToKeystroke(o)})},logPasteToKeystroke:function(e){var t=this.keystrokeModel.get(e+".time");this.keystrokeModel.get(e+".shortcut")?(t+=1,this.keystrokeModel.set(e+".time",t)):(this.keystrokeModel.set(e+".shortcut",!0),t+=1,this.keystrokeModel.set(e+".time",t))},onFormShown:function(){this.model.get("data").keystrokeUri&&this.handleKeystrokeValidation(),this.initializeCardForm(),this.handleStoredCard()},handleStoredCard:function(){var e=this.model.get("data");this.setStoredCardBrand(e),this.configureStoredCardOwnerName(e),this.configureStoredCardNumber(e),this.configureStoredCardExpirationDate(e)},initializeCardForm:function(){this.setUiCards()},setUiCards:function(){this.setCreditCardData(),this.uiCardsView=new e.UiCards({cardModel:this.cardModel}),this.getRegion("cardContainer").show(this.uiCardsView)},setCreditCardData:function(){var e=this.model.get("data");this.cardModel=t.Checkout.Payments.cardData||new t.Checkout.Payments.Models.Card,this.setCardComponentData("cardSize",this.cardSize),e&&e.newCardContext&&this.setCardComponentData("ownerNamePlaceholder",e.newCardContext.ownerNamePlaceholder)},bindEvents:function(){this.on("input:value:changed",this.onInputValueChanged.bind(this)),this.on("input:focus",this.onInputFocus.bind(this)),this.on("input:autocomplete",this.onInputAutocomplete.bind(this)),this.on("input:select:change",this.onInputSelectChange.bind(this)),this.triggerMethod("initializeFlowConditions",this.getCardBehaviorOptions()),this.on("invalidDataFound",this.onInvalidDataFound.bind(this)),this.on("formShown",this.onFormShown.bind(this)),this.on("formComplete",this.onFormSubmit.bind(this)),this.on("input:pastedWithoutFormat",this.onInputValueChanged.bind(this))},showInputValidation:function(e){var t=this.getInputModelById(e),n=t.get("error")||t.get("data.defaultError");if(!n){var i=t.getConstraint("pattern");i&&i.errorMessage&&(n=i.errorMessage)}t.set("error",n),this.handleErroredInput(e)},handleErroredInput:function(e){this.navigateTo(e)},onInvalidDataFound:function(e){this.showInputValidation(e)},onInputFocus:function(e){this.flipCardIfNeeded(this.getInputDOMElement(e))},onInputAutocomplete:function(e){var t=e.model;t.get("id")},onInputSelectChange:function(e){this.uiCardsView.cardAnimation.play(),this.uiCardsView.DocumentAnimation.play();var t=e.model.get("data.value"),n=t.toLowerCase();this.documentModel.set("number",""),this.uiCardsView.updateDocumentContainer(n)},flipCardIfNeeded:function(e){this.uiCardsView.updateCards(e)},configureStoredCardOwnerName:function(e){var t="ownerName",n=this.getInputModelById(t);this.setCardComponentData(t,e.cardHolderName),n.set("data.value",e.cardHolderName)},configureStoredCardNumber:function(e){var t=this.getInputModelById("cardNumber"),n=this.getInputViewByModel(t),i=e.lastFourDigits.toString(),o=Array(this.getCardNumberFormatLength(!1)-i.length+1).join("*"),s=o+i;t.set("data.value",s),this.handleCardNumberFormat(n)},configureStoredCardExpirationDate:function(e){var t=e.expirationMonth.toString(),n=e.expirationYear.toString(),i=new Array(2-t.length+1).join("0")+t,o=n.substr(2,2),s=i+o;this.setCardComponentData("expirationDate",s)},getCardNumberFormatLength:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0,t=this.uiCardsView.getCardNumberFormat().split("-");return t.map(function(e){return Number(e)}).reduce(function(e,t){return e+t})+(e?t.length-1:0)},handleCardNumberFormat:function(e){var t=this,n=e.model,i=n.get("data.value"),o=i.replace(/ /g,"");if(!window.requestAnimationFrame)return void this.setCardComponentData("cardNumber",o);var a=this.uiCardsView.getCardNumberFormat(),r=a.split("-").map(function(e,t){var i=t>0?"?":"",o=n.getAttribute("readOnly"),s=o&&o.name;return s?"(\\d{"+e+"})"+i:"(\\d{"+e+"}|\\*{"+e+"})"+i}),d=new RegExp(r.join(""),"g"),l=d.exec(o),u=Math.min(r.length,l?l.filter(function(e){return void 0!==e}).length:0),c=s.range(1,u+1).map(function(e){return"$"+e}).join(" "),h=o.replace(d,c);window.requestAnimationFrame(function(){t.setCardComponentData("cardNumber",o),n.set("data.value",h.trim())})},setCardComponentData:function(e,t){this.cardModel.set(e,t)},getCardBehaviorOptions:function(){var e=t.channels.flow.request("step:data").inputs,n=e.first_six_digits;return n||t.Checkout.ErrorService["throw"](new MissingDataError({method:"getNewCardBehaviorOptions()",missingKey:"first_six_digits",context:this,type:MissingDataError.type.INPUT,reason:"Unable to get first_six_digits input from data",severity:t.Checkout.ErrorService.severity.WARNING})),{firstSixDigitsInput:n,stepData:this.model.get("data"),cardModel:this.cardModel,documentModel:this.documentModel,onlySecurityCode:!0}},updateSecurityCodeModel:function(){var e=t.channels.flow.request("step:data"),n=e.inputs.securityCode;return n?void this.getInputModelById("securityCode").set("data",n.data):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"updateSecurityCodeModel()",missingKey:"securityCode",context:this,type:MissingDataError.type.INPUT,reason:"Unable to get securityCode input from data",severity:t.Checkout.ErrorService.severity.WARNING}))},changePayment:function(e){var n=this;e.preventDefault();var i=t.channels.flow.request("input:get",{name:"nextStepPayments"});this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:i.output,value:i.output}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.BillingInfoForm=t.composeObjectFrom({baseClass:i.LayoutView,withMixins:[t.Checkout.Mixins.AddressFormInteractions]}).extend({filePath:"src/scripts/modules/payments/views/billing-info-form.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.billingInfoForm,'[data-component="billing-info"]')},ui:{formContainer:'[data-js="billing-info-form-container"]',switchForm:'[data-js="action__form"] button',checkboxAttachment:'[data-attached="true"]',zipCodeInput:'[data-input-id="zipCode"]',submitButton:'[data-js="submit-btn"]'},events:{"click @ui.switchForm":"handleSwitchForm","click @ui.checkboxAttachment":"onStreetWithoutNumberChange","click @ui.submitButton":"handleSubmit"},templateHelpers:function(){return{sections:this.options.model.get("data").form.sections}},behaviors:function o(){var e=this.options.model.get("data"),n=e.form.sections,o={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,isNavigable:!1,classList:"ui-panel--raised",submitButtonText:e.stepContext.submitButtonText,requiredDataText:e.destinationContext?e.destinationContext.requiredDataLabelText:null,sections:n},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:["beforeDestroy"]},Biometrics:{behaviorClass:t.Checkout.Behaviors.Biometrics,formSelector:'form[data-js="form-container"]'},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["switchToIndividualForm","switchToLegalPersonForm"],trackIfPresent:!0},FormatlessPaste:{behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["zipCode"],validMaskRegex:/[^0-9]/g}};return o},initialize:function(){this.destination={}},handleSwitchForm:function(e){var n=this;e.preventDefault();var i=e.target.value;this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:t.channels.flow.request("input:get",{name:i}).output,value:t.channels.flow.request("input:get",{name:i}).output}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save",{replaceRoute:!0})},getStepInputs:function(){return this.options.model.get("inputs")},addOutputsToFlow:function(){var e=this.getInputCollection(),n=e.map(function(e){return{id:e.get("output"),output:e.get("data.value",{formatted:!1})}});t.channels.flow.trigger("output:add",n)},handleSubmit:function(e){e.preventDefault(),this.send()},send:function(){var e=this;this.isFormValid()?(this.trigger("beginSave"),this.addOutputsToFlow(),t.channels.flow.once("saved",function(){e.trigger("flowSaved");
}),t.channels.flow.trigger("save")):this.trigger("flowSaved")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i,o,s){e.CurpForm=i.LayoutView.extend({filePath:"src/scripts/modules/payments/views/curp-form.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.curpForm,'[data-component="curp-form"]')},ui:{formContainer:'[data-js="curp-form-container"]',submitButton:'[data-js="submit-btn"]'},events:{"click @ui.submitButton":"handleSubmit"},behaviors:function a(){var e=this.options.model.get("data"),n=e.form.sections,i=[];n.forEach(function(e){i=i.concat(e.modals)});var a={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,isNavigable:!1,classList:"ui-panel--raised",submitButtonText:e.stepContext.submitButtonText,sections:n,formNote:e.formNote},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:["beforeDestroy"]},Biometrics:{behaviorClass:t.Checkout.Behaviors.Biometrics,formSelector:'form[data-js="form-container"]'},ModalTypeDisplayer:{behaviorClass:t.Behaviors.ModalTypeDisplayer,modals:i},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:this.getAvailableInputsForTracking(),trackIfPresent:!0}};return a},getAvailableInputsForTracking:function(){var e=[],n=t.channels.flow.request("step:data").inputs;return n&&Object.keys(n).forEach(function(t){var i=n[t];i&&i.data&&i.data.events&&e.push(t)}),e},addOutputsToFlow:function(){var e=this.getInputCollection(),n=e.map(function(e){return{id:e.get("output"),output:e.get("data.value",{formatted:!1})}});t.channels.flow.trigger("output:add",n)},handleSubmit:function(e){e.preventDefault(),this.send()},send:function(){var e=this;this.isFormValid()?(this.trigger("beginSave"),this.addOutputsToFlow(),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")):this.trigger("flowSaved")}})}),App.module("Checkout.Review.Views",function(e,t,n,i){e.Review=i.LayoutView.extend({filePath:"scripts/modules/review/views/review.layout.view.js",className:"review",tagName:"section",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.review,'[data-component="review"]')},ui:{heading:'[data-js="stepTitle-heading"]',confirmButton:'[data-id="overview-action"]',heroPaymentsContainer:'[data-component="payment-hero-container"]',changeShippingButton:'[data-js="next-step-shipping-options"]',changeAddressButton:'[data-js="change-address"]',changePaymentForm:'[data-js="change-payment"]',changeInstallmentsButton:'[data-js="change-installments"]',changeShippingAgencies:'[data-js="change-agency"]',changeFrequencyButton:'[data-js="change-frequency"]',changeUserContactInfo:'[data-js="next-step-user-contact-info"]',heroBillingInfoContainer:'[data-component="billing-info-hero-container"]',removeGarex:'[data-js="remove-garex"]'},events:{"click @ui.confirmButton":"clickHandler","click @ui.changeShippingButton":"changeShippingOption","click @ui.changeAddressButton":"changeAddressHandler","submit @ui.changeInstallmentsButton":"changeInstallments","submit @ui.changeShippingAgencies":"handlerSubmitChangeAgency","click @ui.changeFrequencyButton":"changeFrequencyHandler","click @ui.changeUserContactInfo":"handleChangeUserContactInfoClick","submit @ui.removeGarex":"handleRemoveGarex"},regions:{overviewContainer:'[data-js="overview-container"]',heroPaymentsContainer:"@ui.heroPaymentsContainer",heroBillingInfoContainer:"@ui.heroBillingInfoContainer"},behaviors:function(){var e=this.options.model.get("data"),n=e.overview,i=void 0===n?{}:n,o=i.modals;return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["beginSave","showSpinner"],hideOn:["flowSaved","hideSpinner"],timeout:4e3},ShippingOptionsCaller:{behaviorClass:t.Checkout.Behaviors.ShippingOptionsCaller,isModal:!0,inputs:this.options.model.get("inputs")},AddressSelectionCaller:{behaviorClass:t.Checkout.Behaviors.AddressSelectionCaller,isModal:!0},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepShippingOption","nextStepInstallment","nextStepAddressChange","nextStepBillingInfo"],trackIfPresent:!0},AnimationReviewCongrats:{behaviorClass:t.Behaviors.AnimationReviewCongrats,transitionText:e.overview.loadingButtonText,confirmText:e.overview.confirmButtonText},ModalTypeDisplayer:{behaviorClass:t.Behaviors.ModalTypeDisplayer,modals:o,cssClassModifier:"ui-modal-dialog--iframe__ccb"}}},initialize:function(){var e=this;t.channels.cho.on("inconsistencies:changeInstallments",function(t){var n={checkInvalidInstallments:!0,sendAdditionalData:!0};e.renderInstallmentModal(Object.assign(n,t))})},mustShowInstallmentsModal:function(e){return!e.isSplitPayment&&this.hasPaymentInstallments(e.selectedPayments)},hasPaymentInstallments:function(e){return e.reduce(function(e,t){return e?e:t.hasInstallments},!1)},onShow:function(){this.renderPaymentsHero(),this.renderBillingInfoHero(),this.showAccountMoneyOptOutModalIfNeeded()},handleRemoveGarex:function(e){var n=this;e.preventDefault();var i=this.model.get("inputs"),o=i.withoutGarex;if(!o)return void t.Checkout.ErrorService["throw"](new MissingDataError({reason:"cannot confirm remove garex opt-out due to missing input",method:"handleRemoveGarex()",context:this,missingKey:"withoutGarex",type:MissingDataError.type.INPUT,severity:t.Checkout.ErrorService.severity.CRITICAL}));var s=o.output;t.channels.flow.trigger("output:add",{key:s,value:s}),this.trigger("beginSave"),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")},isAccountMoneyPlusOtherMethod:function(){var e=this.model.get("data.selectedPayments");return e.length>1&&void 0!==_.findWhere(e,{type:"account_money"})},mustShowAccountMoneyOptOutModal:function(){return this.isAccountMoneyPlusOtherMethod()&&!_.isEmpty(this.model.get("data.accountMoneyOptOutModalContext"))},showAccountMoneyOptOutModalIfNeeded:function(){if(this.mustShowAccountMoneyOptOutModal()){var e=new n.DeepModel(this.model.get("data.accountMoneyOptOutModalContext")),i=new t.Checkout.Views.ModalMessage({model:e});i.once("modal:userAction:primary",this.confirmAccountMoneyOptOut.bind(this)),i.once("modal:userAction:secondary",function(){t.channels.core.trigger("modal:close")}),t.channels.core.trigger("modal:open",{childView:new t.Checkout.Views.ContentWrapper({contentView:i,className:"ui-list ui-list--modal modal-message--account-money"}),isClosable:!0,isInterceptedClose:!0})}},confirmAccountMoneyOptOut:function(){var e=this,n=this.model.get("inputs"),i=n.dontUseAccountMoney;if(!i)return void t.Checkout.ErrorService["throw"](new MissingDataError({reason:"cannot confirm accountMoney opt-out due to missing input",method:"confirmAccountMoneyOptOut()",context:this,missingKey:"dontUseAccountMoney",type:MissingDataError.type.INPUT,severity:t.Checkout.ErrorService.severity.CRITICAL}));var o=i.output;t.channels.flow.trigger("output:add",{key:o,value:o}),this.trigger("beginSave"),t.channels.flow.once("saved",function(){t.channels.core.trigger("modal:close"),e.trigger("flowSaved"),t.Checkout.Payments.isUsingAccountMoney=!1}),t.channels.flow.trigger("save")},renderBillingInfoHero:function(){var e=this.model.get("inputs").nextStepBillingInfo,i=this.model.get("data").selectedBillingInfo;i&&this.getRegion("heroBillingInfoContainer").show(new t.Checkout.Views.Hero({model:new n.Model({heroData:i}),heroId:"billing-info",iconId:i.icon,buttonName:e.output,buttonValue:e.output,buttonDataId:e.id,formDataJs:"change-billing-info",logoSize:"cho_badge",isMobileWhiteIcon:!0}))},renderPaymentsHero:function(){var e=new t.Checkout.Views.HeroCollection(this.buildPaymentsHeroObject());this.getRegion("heroPaymentsContainer").show(e)},buildPaymentsHeroObject:function(){var e=this.model.get("data"),n=e.selectedPayments,i=this.model.get("inputs").nextStepPayments.output;if(this.mustShowInstallmentsModal(e)){var o=_.findIndex(n,function(e){return e.hasInstallments});n[o].onSave=this.changeInstallments.bind(this)}this.isAccountMoneyPlusOtherMethod()&&this.setAccountMoneyPlusOtherMethodHeroOutput(n);var s={collection:new t.Checkout.Collections.HeroCollection(n),heroId:"payments",buttonName:i,buttonValue:i,formDataJs:"change-payment",logoSize:"cho_badge",isMobileWhiteIcon:!0};return s},setAccountMoneyPlusOtherMethodHeroOutput:function(e){var n=this.model.get("inputs").validateDontUseAccountMoney;if(!n)return void t.Checkout.ErrorService["throw"](new MissingDataError({reason:"cannot render payments hero for AccountMoneyPlusOtherMethod without required input",method:"buildPaymentsHeroObject()",context:this,missingKey:"validateDontUseAccountMoney",severity:t.Checkout.ErrorService.severity.CRITICAL}));var i=n.output,o=_.findIndex(e,function(e){return"account_money"===e.type});Object.assign(e[o],{buttonName:i,buttonValue:i})},getSingleInstallmentModalHeader:function(){var e=this.model.get("data");return new t.Checkout.Review.Views.ChangeInstallmentsHeader({model:new n.Model({title:e.selectionMessageText,disclaimerText:e.overview.disclaimerText})})},getSplitInstallmentModalHeader:function(e){return new t.Checkout.Payments.Views.PaymentDetailHeader({model:new t.Checkout.Payments.Models.PaymentDetailHeader(e.paymentData)})},getInstallmentModalHeader:function(e){return this.model.get("data").isSplitPayment?this.getSplitInstallmentModalHeader(e):this.getSingleInstallmentModalHeader(e)},getInstallmentsCollection:function(e){var n=e.installments.slice();return e.checkInvalidInstallments&&e.sendAdditionalData&&Array.isArray(n)&&Array.isArray(e.invalidInstallments)&&n.forEach(function(t){_.contains(e.invalidInstallments,t.installment)?t.disabled=!0:t.additionalInputs=e.additionalInputs}),new t.Checkout.Payments.Collections.Installments(n)},getInstallmentsListCopy:function(e){var t=[];return Array.isArray(e)&&(t=e.map(function(e){return Object.assign({},e)})),t},getInstallmentsModalWrapperView:function(e,i){var o=null;return this.model.get("data").isSplitPayment||(o=new t.Checkout.Payments.Views.ModalInstallmentsActions({model:new n.Model({installmentsContext:this.model.get("data").paymentContext,inputs:this.model.get("inputs")})})),new t.Checkout.Views.ContentWrapper({containerClass:"ui-list--modal",headerView:e,footerClass:o?"ui-modal-dialog__content-footer":null,footerView:o,headerClass:"ui-list ui-list--modal",contentView:i,contentClass:"ui-list ui-list__content-wrapper"})},renderInstallmentModal:function(e){var n="installmentsSelection",i=t.channels.flow.request("input:get",{name:n}),o=i.data[n],s=_.findWhere(o,{paymentId:e.paymentId});e.installments=this.getInstallmentsListCopy(s.installmentsOptions);var a=this.getInstallmentsCollection(e),r=new t.Checkout.Payments.Views.Installments({collection:a,withoutFeeText:this.model.get("data").upperWithoutFeeText,paymentId:s.paymentId,isModalView:!0}),d=this.getInstallmentModalHeader({installmentsData:s,paymentData:_.findWhere(this.model.get("data").payments,{paymentId:e.paymentId})}),l=this.getInstallmentsModalWrapperView(d,r);t.channels.core.trigger("modal:open",{childView:l,isInterceptedClose:!0})},changeInstallments:function(e){e.preventDefault();var t=e.target.attributes["data-payment"].value;this.renderInstallmentModal({paymentId:t,checkInvalidInstallments:!1,sendAdditionalData:!1})},changeAddressHandler:function(e){e.preventDefault();var t=this.model.get("data"),i=t.selectedAddress?t.selectedAddress.isNewAddress:!1,o=t.addressList,s=new n.Model({data:t,inputs:t.inputs});i||0===o.length||null===o.length?this.triggerMethod("displayAddressFlow",s):this.options.isAddressHubEnable?this.goToAddressHub():this.triggerMethod("displayAddressList",s)},goToAddressHub:function(){var e=this;this.trigger("beginSave");var n=this.model.get("inputs.nextStepAddressHub");n&&t.channels.flow.trigger("output:add",{key:n.output,value:n.output}),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")},changeFrequencyHandler:function(e){e.preventDefault();var i=t.channels.flow.request("step:data").data.frequencySelector,o=new n.Model(i.content),s=new t.Checkout.Views.FrequencyModal({model:o}),a=new n.Model(i.header),r=new t.Checkout.Views.FrequencyModalHeader({model:a}),d=new t.Checkout.Views.ContentWrapper({contentClass:"ui-list ui-list__content",headerClass:"quantity-selector__header",contentView:s,headerView:r});t.channels.core.trigger("modal:open",{childView:d,isInterceptedClose:!0})},clickHandler:function(e){e.preventDefault(),this.triggerMethod("customTrack",{event:"click",inputName:"nextStepConfirm"}),this.triggerMethod("send")},changeShippingOption:function(e){e.preventDefault();var n=this.model.get("data");if(n.isSplit){var i=t.channels.flow.request("input:get",{name:"nextStepShippingOption"}),o=t.channels.flow.request("input:get",{name:"splitShippingModification"});this.nextStepShippingOption(i.output,o.output)}else this.displayShippingOptions(e)},nextStepShippingOption:function(e,n){t.channels.flow.trigger("output:add",{key:e,value:e}),t.channels.flow.trigger("output:add",{key:n,value:n}),t.channels.flow.trigger("save")},displayShippingOptions:function(e){e.preventDefault();var t=this.getSingleShippingOptionsModel()||this.getPackageShippingOptionsModel(e),n=this.model.get("data").packsConfigsContext;this.triggerMethod("displayShippingOptions",{model:t,packsConfigsContext:n})},getPackageShippingOptionsModel:function(e){var i=e.target.parentNode.querySelector('[data-js="package-id"]');i||t.channels.cho.trigger("error:trackNewRelic",'Checkout.Review.Views.Review#getPackageShippingOptionsModel: can\'t find [data-js="package-id"] on parent');var o=i.value,s=new n.Model(_.findWhere(this.model.get("data").packConfig.packs,{id:o}));return s},getSingleShippingOptionsModel:function(){var e=this.model.get("data").shippingConfig;return e?new n.Model(e):null},handlerSubmitChangeAgency:function(e){var n=this;e.preventDefault(),this.trigger("beginSave");var i=this.model.get("inputs").nextStepAgencies;t.channels.flow.trigger("output:add",{key:i.output,value:i.id}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")},handleChangeUserContactInfoClick:function(e){e.preventDefault(),this.changeUserContactInfoHandler()},changeUserContactInfoHandler:function(){var e=this,n=this.model.get("inputs").nextStepUserContactInfo;n||t.Checkout.ErrorService["throw"](new MissingDataError({method:"changeUserContactInfoHandler()",missingKey:"inputs.nextStepUserContactInfo",context:this,type:MissingDataError.type.INPUT,reason:"Missing nextStepUserContactInfo input",severity:t.Checkout.ErrorService.severity.CRITICAL})),this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:n.output,value:n.id}),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Review.Views",function(e,t){e.SingleReview=e.Review.extend({tagName:"section",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.singleReview,'[data-component="single-review"]')}})});var _slicedToArray=function(){function e(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(d){o=!0,s=d}finally{try{!i&&r["return"]&&r["return"]()}finally{if(o)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();App.module("Checkout.Shipping.Views",function(e,t,n,i){e.NewAddressForm=t.composeObjectFrom({baseClass:i.LayoutView,withMixins:[t.Checkout.Mixins.AddressFormInteractions]}).extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.newAddressVertical,'[data-component="shipping-new-address-form"]')},ui:{formContainer:'[data-component="new-address-form"]',submitButton:'[data-js="submit-btn"]',checkboxAttachment:'[data-attached="true"]',zipCodeInput:'[data-input-id="zipCode"]',city:'[data-js="autocomplete-input"]'},events:{"click @ui.submitButton":"onFormSubmit","click @ui.checkboxAttachment":"onStreetWithoutNumberChange","input @ui.zipCodeInput":"onZipCodeInput","paste @ui.zipCodeInput":"onZipCodeInput","blur @ui.zipCodeInput":"onZipCodeBlur"},behaviors:function(){var e=this.getStepInputs(),n=this.options.model.get("data");return{Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,inputs:e,classList:"ui-panel--raised",submitButtonText:n.stepContext.submitButtonText,requiredDataText:n.destinationContext?n.destinationContext.requiredDataLabelText:null},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["unknownZipCodeLink"],trackIfPresent:!0},FormatlessPaste:{behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["zipCode"],validMaskRegex:/[^0-9]/g}}},initialize:function(){this.destination={}},onShow:function(){this.bindEvents(),setTimeout(this.onZipCodePreloaded.bind(this),100)},bindEvents:function(){this.on("input:value:changed",this.onInputValueChanged.bind(this)),this.on("input:focus",this.onInputFocus.bind(this))},getStepInputs:function(){return this.options.model.get("inputs")},onInputValueChanged:function(e){var t=e.model,n=t.get("id"),i=this.getInputModelById("nextStepFetchCities"),o=this.getInputModelById("nextStepValidateCity");"state"===n&&i&&this.onStateChanged(i),"city"===n&&o&&this.onCityChanged(o)},onUpdateInput:function(e){var n=this;Object.entries||(Object.entries=t.Checkout.ObjectEntries.build(e)),Object.entries(e.stepData.inputs).forEach(function(e){var t=_slicedToArray(e,2),i=(t[0],t[1]),o=i.error,s=n.getInputModelById(i.id);o&&s.set("error",o)})},onInputFocus:function(e){e.model.set("error","")},onUpdateZipCode:function(e){var t=e.hasError,n=e.stepData,i=n.inputs,o=n.inputs.zipCode;if(t)this.setErrorConstrainst(o);else{if(i.state){var s=this.getInputModelById(i.state.id);s.set("data",{}),s.set("data",i.state.data)}if(i.city){var a=this.getInputModelById(i.city.id);a.set("data",i.city.data),this.validateCityInconsistency(e)}if(i.colony){var r=this.getInputView(i.colony.id);r.model.set("data",{}),r.model.set("data",i.colony.data),"autocomplete"===i.colony.type&&r.setOptionPreSelected()}}this.updateZipCode(e)},validateCityInconsistency:function(e){var t=e.stepData,n=t.inputs,i=this.getInputModelById(n.city.id),o=n.city.error;o?(i.addConstraint({name:"nonEquals",value:i.get("data.value"),errorMessage:o}),this.ui.city.focus(),i.addConstraint({name:"invalidRemoteConstraint",errorMessage:o},!0)):(i.removeConstraint("invalidRemoteConstraint",!1),i.removeConstraint("nonEquals",!1))},setErrorConstrainst:function(e){var t=this.getInputModelById(e.id);t.addConstraint({name:"nonEquals",value:t.get("data.value"),errorMessage:e.error}),t.addConstraint({name:"invalidRemoteConstraint",errorMessage:e.error},!0)},onZipCodePreloaded:function(){var e=t.channels.flow.request("step:data"),n=e.inputs;if(n.zipCode){var i=this.getInputModelById(n.zipCode.id),o=i.get("data.value");o&&this.onZipCodeBlur()}},onFormSubmit:function(e){e.preventDefault(),this.getErrorAndTrackInputs(),this.sendDataStateHandler()},sendDataStateHandler:function(){this.trigger("beginSave"),this.isFormValid()&&!this.destination.isInvalid?this.send():this.isFormValid()&&this.destination.isValidating?this.delayedSend():this.trigger("flowSaved")},delayedSend:function(){var e=this;this.once("zipCodeValidated",function(){e.destination.isInvalid?e.trigger("flowSaved"):e.send()})},addOutputsToFlow:function(){var e=this.getInputCollection(),n=e.reject(function(e){return _.contains(["nextStepValidateDestination"],e.get("id"))&&!e.get("data")}).map(function(e){return{id:e.get("output"),output:e.get("data.value",{formatted:!1})}});t.channels.flow.trigger("output:add",n)},send:function(){var e=this;this.addOutputsToFlow(),t.channels.flow.once("saved",function(){return e.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i,o,s){e.AddressForm=t.composeObjectFrom({baseClass:i.LayoutView,withMixins:[t.Checkout.Mixins.AddressFormInteractions]}).extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.newAddress,'[data-component="shipping-new-address"]')},ui:{formContainer:'[data-component="new-address-form"]',submitButton:'[data-js="submit-btn"]',checkboxAttachment:'[data-attached="true"]',zipCodeInput:'[data-input-id="zipCode"]'},events:{"click @ui.submitButton":"onFormSubmit","click @ui.checkboxAttachment":"onStreetWithoutNumberChange","input @ui.zipCodeInput":"onZipCodeInput","paste @ui.zipCodeInput":"onZipCodeInput"},initialize:function(){this.destination={}},getStepInputs:function(){return this.options.model.get("inputs")},addOutputsToFlow:function(){var e=this.getInputCollection(),n=e.reject(function(e){return s.contains(["addressId","nextStepValidateDestination"],e.get("id"))&&!e.get("data")}).map(function(e){return{id:e.get("output"),output:e.get("data.value",{formatted:!1})}});t.channels.flow.trigger("output:add",n),this.trackAddressProfile(n)},onUpdateZipCode:function(e){var t=e.hasError,n=e.stepData,i=n.inputs,o=n.inputs.zipCode;if(t)this.setErrorConstraint(o);else{if(i.state){var s=this.getInputModelById(i.state.id);s.set("data",{}),s.set("data",i.state.data)}if(i.city){var a=this.getInputModelById(i.city.id);a.set("data",i.city.data)}}this.updateZipCode(e)},setErrorConstraint:function(e){var t=this.getInputModelById(e.id);t.addConstraint({name:"nonEquals",value:t.get("data.value"),errorMessage:e.error}),t.addConstraint({name:"invalidRemoteConstraint",errorMessage:e.error},!0)},onFormSubmit:function(e){e.preventDefault(),this.sendDataStateHandler()},sendDataStateHandler:function(){this.trigger("beginSave"),this.isFormValid()&&!this.destination.isInvalid?this.send():this.isFormValid()&&this.destination.isValidating?this.delayedSend():this.trigger("flowSaved")},delayedSend:function(){var e=this;this.once("zipCodeValidated",function(){e.destination.isInvalid?e.trigger("flowSaved"):e.send()})},trackAddressProfile:function(e){var n=s.findWhere(e,{id:"addressProfile"});this.addressProfileValue=n?n.output:null;var i=this.options.model.get("data").addressProfileTrack;i&&(i.GA.label=this.addressProfileValue,i.MD.data.label=this.addressProfileValue,t.Track.analyticsEvent(i.GA),t.Track.melidataEvent(i.MD))},send:function(){var e=this;this.addOutputsToFlow(),t.channels.flow.once("saved",function(){return e.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.AddressSelection=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.addressSelection,'[data-component="address-selection"]')},ui:{addressList:'[data-component="address-list"]'},regions:{addressListSelection:"@ui.addressList"},onShow:function(){var e=new t.Checkout.Shipping.Views.Addresses({collection:this.options.collection,zipCodeText:this.options.zipCodeText});this.getRegion("addressListSelection").show(e)}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.SelectionListLayout=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.selectionList,'[data-component="selection-list"]')},ui:{selectionListRegion:'[data-js="selection-list-items"]'},regions:{selectionList:"@ui.selectionListRegion"},onShow:function(){t.Checkout.ScrollUtils.scrollTo({offsetTop:0,duration:0}),this.renderSelectionListItems()},renderSelectionListItems:function(){var t=this.options.output?this.options.output:this.model.get("inputs").selectionList.data.inputToUse,n=new e.SelectionListItems({collection:this.collection,output:t});this.getRegion("selectionList").show(n)}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.Package=i.LayoutView.extend({tagName:"li",ui:{shippingOptionsForm:'[data-js="shipping-option-form"]'},events:{"submit @ui.shippingOptionsForm":"shippingOptionsHandler"},behaviors:function(){return{ShippingOptionsCaller:{behaviorClass:t.Checkout.Behaviors.ShippingOptionsCaller,isModal:!0,inputs:this.options.inputs},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepShippingOption","selectedShippingOption"],trackIfPresent:!0}}},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._package,'[data-component="package"]')},templateHelpers:function(){return{data:this.options.data,inputs:t.channels.flow.request("step:data").inputs}},shippingOptionsHandler:function(e){e.preventDefault(),this.triggerMethod("displayShippingOptions")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingMapLayout=i.LayoutView.extend({filePath:"src/scripts/modules/shipping/views/shipping-map.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.shippingMap,'[data-component="shipping-map"]')},className:function(){return"shipping-map-wrapper"},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["beginSave","google:spinner:show"],hideOn:["flowSaved","google:spinner:hide"]},MapPosition:{behaviorClass:t.Behaviors.MapPosition},AgenciesFetch:{behaviorClass:t.Behaviors.AgenciesFetch}},ui:{map:'[data-component="map"]',infoBox:'[data-js="info-box"]'},regions:{map:"@ui.map"},initialize:function(){var e="https://http2.mlstatic.com/resources/frontend/statics/buyingflow-frontend-core/scripts/cho__map.js";t.Checkout.assetsLoader.scriptExists(e)||t.Checkout.assetsLoader.addScript(e),this.once("agencies:fetch:success",this.mapDataFetchResponseHandler.bind(this)),this.once("agencies:fetch:empty",this.mapDataFetchResponseHandler.bind(this)),this.once("agencies:fetch:error",this.mapDataFetchError.bind(this)),t.channels.cho.once("google:maps:loaded",this.handlerGoogleLoaded.bind(this)),this.selectorAgencyLink="ui-button--info-box",this.lastAction=""},onShow:function(){this.trigger("google:spinner:show")},handlerGoogleLoaded:function(){var e=this.model.get("data.geolocation");this.triggerMethod("fetch:map:data",e,"geo_location")},onPositionSuccess:function(e){this.model.set("data.geolocation",e)},onPositionFinished:function(){var e=this.model.get("data.googleMapsConfig");return e?void t.channels.cho.trigger("google:maps:load",e):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"onShow()",missingKey:"googleMapsConfig",context:this,type:MissingDataError.type.DATA,reason:"googleMapsConfig is required",severity:t.Checkout.ErrorService.severity.WARNING}))},mapDataFetchResponseHandler:function(e){var t=this.buildModel(),n=this.model.get("data.geolocation");t.set("data.mapData",e.toJSON()),t.set("data.geolocation",n);var i=e.get("defaults.defaultType");t.set("data.defaultType",i),this.renderMap(t),this.trigger("google:spinner:hide"),this.trackDefaultType(i)},renderMap:function(e){var n=new t.Checkout.Views.MapAgencies({model:e});this.bindUIElements(),this.bindMapEvents(n),this.getRegion("map").show(n)},bindMapEvents:function(e){this.listenTo(e,"map:load",this.handlerLoadShippingAgenciesMap.bind(this)),this.listenTo(e,"map:pins:load",this.handlerMapPinsLoaded.bind(this)),this.listenTo(e,"map:pins:preload",this.handlerMapPinsLoaded.bind(this)),this.listenTo(e,"map:pin:confirmed",this.handlerClickAgencySelected.bind(this)),this.listenTo(e,"map:action",this.setUserLastAction.bind(this)),this.listenTo(e,"map:fetch:empty",this.trackAgenciesNotFound.bind(this))},setUserLastAction:function(e){this.lastAction=e},mapDataFetchError:function(){t.channels.cho.trigger("app:fatalError")},handlerMapPinsLoaded:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.agencies,n=void 0===t?[]:t;if(n.length){var i=this.getRegion("map").currentView;this.model.get("inputs.suggestedShippingAgencies.data.value")||this.model.set("inputs.suggestedShippingAgencies.data.value",n.map(function(e){return e.id})),this.stopListening(i,"map:pins:load",this.handlerMapPinsLoaded.bind(this)),this.stopListening(i,"map:pins:preload",this.handlerMapPinsLoaded.bind(this))}},handlerLoadShippingAgenciesMap:function(e){this.model.set("data.initialPosition",e.position)},handlerClickAgencySelected:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1;this.model.set("inputs.selectedExtraInfoAgency.data.value",e.selectedOption.extraInfo),this.model.set("inputs.selectedShippingAgencyLongitude.data.value",e.agency.pin.location.longitude),this.model.set("inputs.selectedShippingAgencyLatitude.data.value",e.agency.pin.location.latitude),this.trackSuggestedAgencies(e,i,o);var s=Object.keys(this.model.get("inputs")),a=s.map(function(e){return{id:n.model.get("inputs."+e+".output"),output:n.model.get("inputs."+e+".data.value")}});t.channels.flow.trigger("output:add",a),t.channels.flow.trigger("save"),this.trigger("beginSave"),t.channels.flow.once("saved",function(){return n.trigger("flowSaved")})},isSuggestedAgency:function(e){var t=this.model.get("inputs.suggestedShippingAgencies.data.value");return t?t.indexOf(e)>-1:!1},trackDefaultType:function(e){var n=this.model.get("data.defaultTypeTrack");return t.Checkout.Helpers.canTrackToAnalytics(n)?(n.GA.label=e,void t.Track.analyticsEvent(n.GA)):void t.Checkout.ErrorService["throw"](new MissingDataError({type:MissingDataError.type.DATA,missingKey:"defaultTypeTrack",context:this,reason:"Cannot track defaultTypeTrack, missing GA key",method:"trackDefaultType"}))},trackSuggestedAgencies:function(e,n,i){var o=this.model.get("data.suggestedAgenciesTrack");if(!t.Checkout.Helpers.canTrackToAnalyticsAndMelidata(o))return void t.Checkout.ErrorService["throw"](new MissingDataError({type:MissingDataError.type.DATA,missingKey:"suggestedAgenciesTrack",context:this,reason:"Cannot track suggestedAgenciesTrack, missing GA and/or MD keys",method:"trackSuggestedAgencies"}));var s=e.agency.id,a=this.isSuggestedAgency(s),r=this.model.get("data.initialPosition"),d=this.getRegion("map").currentView.model.get("data.defaultType"),l=e.agency.pin.distanceRaw,u=e.agency.pin.location.latitude,c=e.agency.pin.location.longitude;o.GA.label=a?"SUGGESTED":"NOT_SUGGESTED",Object.assign(o.MD.data,{default_location_info:{suggested:a,type:d},filters_present:i,selected_filters:n,latitude:r.lat(),longitude:r.lng(),distance:l,agency_latitude:u,agency_longitude:c,last_action:this.lastAction}),t.Track.analyticsEvent(o.GA),t.Track.melidataEvent(o.MD)},trackAgenciesNotFound:function(e){var n=e.position,i=this.model.get("data.storeNotFoundTrack");return t.Checkout.Helpers.canTrackToAnalyticsAndMelidata(i)?(Object.assign(i.MD.data,n),t.Track.analyticsEvent(i.GA),void t.Track.melidataEvent(i.MD)):void t.Checkout.ErrorService["throw"](new MissingDataError({type:MissingDataError.type.DATA,missingKey:"storeNotFoundTrack",context:this,reason:"Cannot track storeNotFoundTrack, missing GA and/or MD keys",method:"storeNotFoundTrack"}))},unbindMapEvents:function(){t.channels.cho.off("google:maps:loaded"),this.off("agencies:fetch:success"),this.off("agencies:fetch:empty"),this.off("agencies:fetch:error")},onDestroy:function(){this.unbindMapEvents()}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingAgenciesMapLayout=i.LayoutView.extend({filePath:"src/scripts/modules/shipping/views/shipping-agencies-map.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.shippingAgenciesMap,'[data-component="shipping-agencies"]')},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["beginSave","google:spinner:show"],hideOn:["flowSaved","google:spinner:hide"]}},ui:{map:'[data-component="map"]',infoBox:'[data-js="info-box"]'},regions:{map:"@ui.map"},initialize:function(){t.channels.cho.once("google:maps:loaded",this.handlerGoogleLoaded.bind(this)),this.selectorAgencyLink="agency-selected"},onShow:function(){this.trigger("google:spinner:show");var e=t.channels.flow.request("step:data").data;e.sessionId=this.model.get("sessionId");
var n=e.googleMapsConfig;return n?void t.channels.cho.trigger("google:maps:load",n):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"onShow()",missingKey:"googleMapsConfig",context:this,type:MissingDataError.type.DATA,reason:"googleMapsConfig is required",severity:t.Checkout.ErrorService.severity.WARNING}))},handlerGoogleLoaded:function(){this.trigger("google:spinner:hide");var e=this.buildModel();e.set("collapsible",!0);var n=e.get("data.defaultLocation")?new t.Checkout.Views.MapDefaultLocation({model:e}):new t.Checkout.Views.MapGeolocation({model:e});this.getRegion("map").show(n),this.bindUIElements(),this.listenTo(n,"info:box:show",this.onInfoBoxShow.bind(this)),this.listenTo(n,"map:load",this.handlerLoadShippingAgenciesMap.bind(this)),this.listenTo(n,"map:pins:notFound",this.handlerPinsNotFound.bind(this)),this.listenTo(n,"map:pins:load",this.handlerMapPinsLoaded.bind(this)),this.listenTo(n,"map:pins:preload",this.handlerMapPinsLoaded.bind(this))},buildModel:function(){},handlerMapPinsLoaded:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pins,n=void 0===t?[]:t;if(n.length){var i=this.getRegion("map").currentView;this.model.get("inputs.suggestedShippingAgencies.data.value")||this.model.set("inputs.suggestedShippingAgencies.data.value",n.map(function(e){return e.agencyId})),this.stopListening(i,"map:pins:load",this.handlerMapPinsLoaded.bind(this)),this.stopListening(i,"map:pins:preload",this.handlerMapPinsLoaded.bind(this))}},handlerLoadShippingAgenciesMap:function(e){this.model.set("data.initialPosition",e.position),this.trackInitialPosition(e.position),this.ui.infoBox.on("click",'[data-js="'+this.selectorAgencyLink+'"]',this.handlerClickAgencySelected.bind(this))},onInfoBoxShow:function(e){var t=e.data.pinData;this.model.set("inputs.selectedShippingAgency.data.value",t.agencyId),this.model.set("inputs.selectedShippingAgencyLongitude.data.value",t.pin.lng),this.model.set("inputs.selectedShippingAgencyLatitude.data.value",t.pin.lat)},handlerClickAgencySelected:function(e){var n=this;e.preventDefault(),this.trackSuggestedAgencies();var i=Object.keys(this.model.get("inputs")),o=i.map(function(e){return{id:n.model.get("inputs."+e+".output"),output:n.model.get("inputs."+e+".data.value")}});t.channels.flow.trigger("output:add",o),t.channels.flow.trigger("save"),this.trigger("beginSave"),t.channels.flow.once("saved",function(){return n.trigger("flowSaved")})},trackSuggestedAgencies:function(){var e=this.model.get("data.suggestedAgenciesTrack"),n=this.model.get("inputs.suggestedShippingAgencies.data.value"),i=this.model.get("inputs.selectedShippingAgency.data.value"),o=n?n.indexOf(i)>-1:!1,s=this.model.get("data.initialPosition");return e?(e.MD.data.suggested=o,void this.trackGeoposition(e,s)):void t.Checkout.ErrorService["throw"](new MissingDataError({type:MissingDataError.type.DATA,missingKey:"tracksNotFound",context:this,reason:"Cannot track suggestedAgenciesTrack in Melidata",method:"trackSuggestedAgencies"}))},trackGeoposition:function(e,n){e.GA&&t.Track.analyticsEvent(e.GA),e.MD&&(e.MD.data.lat=n.lat(),e.MD.data["long"]=n.lng(),t.Track.melidataEvent(e.MD))},handlerPinsNotFound:function(e){var n=e.position,i=this.model.get("data.tracksNotFound");return i?void this.trackGeoposition(i,n):void t.Checkout.ErrorService["throw"](new MissingDataError({type:MissingDataError.type.DATA,missingKey:"tracksNotFound",context:this,reason:"Cannot track map:pins:notFound event in Melidata or Analytics",method:"handlerPinsNotFound"}))},trackInitialPosition:function(e){var n=this.model.get("data.initialLocationTrack");return n?void this.trackGeoposition(n,e):void t.Checkout.ErrorService["throw"](new MissingDataError({type:MissingDataError.type.DATA,missingKey:"initialLocationTrack",context:this,reason:"Cannot track map initial position in Melidata",method:"trackInitialPosition"}))},onDestroy:function(){t.channels.cho.off("google:maps:loaded")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingSelection=i.LayoutView.extend({filePath:"src/scripts/modules/shipping/views/shipping-selection.layout.view.js",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.shipping,'[data-component="shipping-selection"]')},ui:{text:"[type=text]",summaryForm:'[data-component="summary-component"] form'},regions:{shippingContext:'[data-component="shipping-context"]',shippingAddressInfo:'[data-component="shipping-address-info"]',cartPackages:'[data-component="cart-packages"]',summaryComponent:'[data-component="summary-component"]'},summaryComponentModifier:"summary--fixed",events:{"submit @ui.summaryForm":"send"},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"beforeDestroy"}},templateHelpers:function(){var e=t.channels.flow.request("step:data").data;return{disclaimerCorreios:e.disclaimerCorreios}},showShippingContext:function(){var e=this.getShippingContextData();if(e.selectedAddress||e.selectedDestination){var n=new t.Checkout.Shipping.Models.ShippingContext(e),i=new t.Checkout.Shipping.Views.ShippingContext({model:n,isAddressHubEnable:e.isAddressHubEnable});this.getRegion("shippingContext").show(i)}},showShippingAddressInfo:function(){var e=this.getShippingAddressInfoData(),i=new t.Checkout.Shipping.Views.ShippingAddressInfo({model:new n.DeepModel(e),isAddressHubEnable:e.isAddressHubEnable});this.getRegion("shippingAddressInfo").show(i)},checkForAddressInfo:function(){var e=this.model.get("data").selectedAddress;e&&this.showShippingAddressInfo()},showCartPackages:function(){var e=new t.Checkout.Shipping.Collections.CartPackages(this.getCartPackagesData()),n=new t.Checkout.Shipping.Views.CartPackages({collection:e,model:this.model});this.getRegion("cartPackages").show(n)},showSummaryComponent:function(){var e=new t.Checkout.Models.FooterComponent(this.getFooterComponentData()),n=this.model.get("data"),i={model:e,actionButton:!0,buttonText:n.stepContext.submitButtonText,disclaimer:n.disclaimer};null!==this.summaryComponentModifier&&(i.summaryModifier=this.summaryComponentModifier);var o=new t.Checkout.Views.SummaryComponent(i);this.getRegion("summaryComponent").show(o)},onShow:function(){this.showShippingContext(),this.showCartPackages(),this.showSummaryComponent(),"mobile"===t.Config.device&&this.checkForAddressInfo();var e=this.model.get("data").bfDiscounts;e&&e.hasAvailableBfDiscounts&&t.channels.cho.trigger("hotjar:tagRecording",["bfDiscounts:rebates"])},getShippingContextData:function(){var e=this.model.get("data");return{selectedDestination:e.selectedDestination,selectedAddress:e.selectedAddress,inputs:this.model.get("inputs"),addressesContext:e.addressesContext,addressList:e.addressList,heroContext:e.heroContext,title:this.model.get("title"),isAddressHubEnable:e.isAddressHubEnable||!1}},getShippingAddressInfoData:function(){var e=this.model.get("data");return{selectedDestination:e.selectedDestination,selectedAddress:e.selectedAddress,inputs:this.model.get("inputs"),addressList:e.addressList,addressesContext:e.addressesContext,isAddressHubEnable:e.isAddressHubEnable||!1}},getCartPackagesData:function(){var e=this.model.get("data"),n=e.packConfig?e.packConfig.packs:"";return e.packConfig&&n||t.Checkout.ErrorService["throw"](new MissingDataError({method:"getCartPackagesData()",missingKey:"packConfig.packs",context:this,type:MissingDataError.type.DATA,severity:t.Checkout.ErrorService.severity.WARNING})),n},getFooterComponentData:function(){var e=this.model.get("data").footer;return e||t.Checkout.ErrorService["throw"](new MissingDataError({method:"getFooterComponentData()",missingKey:"footer",context:this,type:MissingDataError.type.DATA,severity:t.Checkout.ErrorService.severity.WARNING})),{dataFooter:e}},send:function(e){e.preventDefault(),this.trigger("beginSave"),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.Split=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.shippingSplit,'[data-component="shipping-split"]')},ui:{shippingMethodOptionButton:'[data-js="shipping-method-option"]'},events:{"click @ui.shippingMethodOptionButton":"handleFormSubmit"},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:this.getAvailableInputsForTracking(),trackIfPresent:!0}}},getAvailableInputsForTracking:function(){var e=[],n=t.channels.flow.request("step:data").inputs;return n&&Object.keys(n).forEach(function(t){var i=n[t];i&&i.enabled&&i.tracking&&e.push(t)}),e},handleFormSubmit:function(e){e.preventDefault();var t=e.target.value;this.saveMethod(t)},saveMethod:function(e){var n=this;this.trigger("beginSave"),t.channels.flow.trigger("output:add",{key:e,value:e}),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.SingleShippingOptionsSelection=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.singleShippingOptionsSelection,'[data-component="single-shipping-selection"]')},ui:{discountButton:'[data-js="discount-button"]',shippingOptions:'[data-js="shipping-options-region"]',continueButton:'[data-js="list-submit"]',errorMessage:'[data-js="ui-list__error"]'},events:{"click @ui.discountButton":"displayDiscountMessage","click @ui.shippingOptions":"unbindDropoutEvents","click @ui.continueButton":"handleShippingOptionSelection"},regions:{shippingContext:'[data-component="shipping-context"]',shippingAddressInfo:'[data-component="shipping-address-info"]'},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},templateHelpers:function(){var e=t.channels.flow.request("step:data").data;return{disclaimerCorreios:e.disclaimerCorreios}},showInModal:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;t.channels.core.trigger("modal:open",{childView:new t.Checkout.Views.ContentWrapper(e),isClosable:n,isInterceptedClose:i})},displayDiscountMessage:function(){var e=this.model.get("data").footer.discount,i=new n.Model(e),o=new t.Checkout.Views.ModalMessage({model:i});t.channels.core.trigger("modal:close"),this.showInModal({contentView:o,className:"ui-list ui-list--modal ui-list--modal--discounts"})},showShippingContext:function(){var e=this.getShippingContextData();if(e.selectedAddress||e.selectedDestination){var n=new t.Checkout.Shipping.Models.ShippingContext(e),i=new t.Checkout.Shipping.Views.ShippingContext({model:n,isAddressHubEnable:this.options.isAddressHubEnable});this.getRegion("shippingContext").show(i)}},getShippingContextData:function(){var e=this.model.get("data");return{selectedDestination:e.selectedDestination,selectedAddress:e.selectedAddress,inputs:this.model.get("inputs"),addressesContext:e.addressesContext,addressList:e.addressList,heroContext:e.heroContext,title:this.model.get("title"),subtitle:e.subtitle}},showShippingAddressInfo:function(){var e=this.getShippingAddressInfoData(),i=new t.Checkout.Shipping.Views.ShippingAddressInfo({model:new n.DeepModel(e),isAddressHubEnable:this.options.isAddressHubEnable});this.getRegion("shippingAddressInfo").show(i)},getShippingAddressInfoData:function(){var e=this.model.get("data");return{selectedDestination:e.selectedDestination,selectedAddress:e.selectedAddress,inputs:this.model.get("inputs"),addressList:e.addressList,addressesContext:e.addressesContext}},checkForAddressInfo:function(){var e=this.model.get("data").selectedAddress;e&&this.showShippingAddressInfo()},shippingOptionsView:function(e,n){var i=this.model.get("data").shippingConfig;return new t.Checkout.Shipping.Views.ShippingOptions({collection:e,shippingOptionsSelectionView:!0,isModalView:!1,hasToBeTrackedOutsideOfModalView:!0,hideChevron:!0,autoRipple:!0,packageId:i.id,subtitle:n})},showShippingOptions:function(){var e=this,n=this.model.get("data").shippingConfig;return n?(this.shippingGroupViews=[],void n.shippingGroups.forEach(function(n,i){var o=new t.Checkout.Shipping.Collections.ShippingOptions(n.shippingOptions),s=e.shippingOptionsView(o,n.subtitle);s.on("radioClick",function(){e.onRadioClick(s)}),e.addRegion("options-group-region"+i,'[data-js="shipping-options-group-'+i+'"]'),e.getRegion("options-group-region"+i).show(s),e.shippingGroupViews.push(s)})):void t.Checkout.ErrorService["throw"](new MissingDataError({method:"showShippingOptions()",missingKey:"data.shippingConfig",context:this,type:MissingDataError.type.DATA,reason:"Missing shippingConfig data",severity:t.Checkout.ErrorService.severity.CRITICAL}))},bindDropoutEvents:function(){var e=this;window.addEventListener("unload",function(){t.channels.cho.trigger("hotjar:tagRecording",["shipping:dropout"]),e.unbindDropoutEvents()})},onRadioClick:function(e){this.collectionViewWithSelectedOption=e;var t=this.shippingGroupViews.filter(function(t){return t!==e});t.forEach(function(e){e.unSelectAllOptions()}),this.hideListError()},handleShippingOptionSelection:function(e){return e.preventDefault(),this.collectionViewWithSelectedOption?(this.submitSelectedShippingOption(),!0):(this.showListError(),!1)},showListError:function(){this.ui.shippingOptions.addClass("ui-options-container--error"),this.ui.errorMessage.removeClass("ui-list__error-hidden")},hideListError:function(){this.ui.shippingOptions.removeClass("ui-options-container--error"),this.ui.errorMessage.addClass("ui-list__error-hidden")},submitSelectedShippingOption:function(){var e=this;this.trigger("beginSave");var n=t.channels.flow.request("input:get",{name:"nextStepShippingOption"}),i=t.channels.flow.request("input:get",{name:"packageId"}),o=this.collectionViewWithSelectedOption.collection.models.filter(function(e){return e.get("selected")===!0})[0];t.channels.flow.trigger("output:add",{key:t.channels.flow.request("input:get",{name:"selectedShippingOption"}).output,value:o.get("id")}),i&&t.channels.flow.trigger("output:add",{key:i.output,value:this.collectionViewWithSelectedOption.options.packageId}),n&&t.channels.flow.trigger("output:add",{key:n.output,value:n.output}),t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")},unbindDropoutEvents:function(){window.removeEventListener("unload",this.bindDropoutEvents,!1)},onShow:function(){this.showShippingContext(),this.showShippingOptions(),"desktop"===t.Config.device?this.bindDropoutEvents():this.checkForAddressInfo();var e=this.model.get("data").bfDiscounts;e&&e.hasAvailableBfDiscounts&&t.channels.cho.trigger("hotjar:tagRecording",["bfDiscounts:rebates"])}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.AddressProfile=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shared.inputsPage._inputsPage,'[data-component="address-profile"]')},ui:{formContainer:'[data-js="address-profile-form-container"]',submitButton:'[data-js="submit-btn"]',form:'[data-js="form-container"]'},events:{"click @ui.submitButton":"onFormSubmit"},behaviors:function(){var e=this.options.model.get("data"),n=e.stepContext;return{Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,inputs:this.options.model.get("inputs"),submitButtonText:n.submitButtonText,formId:"address-profile-info-form",hideSubmitButton:!0,classList:"ui-panel--raised address-profile--panel"},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},templateHelpers:function(){return{id:"address-profile",containerModifiers:"address-profile-form__title",transparentButton:!1}},addOutputToFlow:function(){var e=t.channels.flow.request("step:data"),n=e.data.form.inputs,i=this.getInputModel(n.addressProfile.id);this.trackAddressProfile(i),t.channels.flow.trigger("output:add",{key:i.get("output"),value:i.get("data.value")})},trackAddressProfile:function(e){var n=e?e.get("data.value"):null,i=this.options.model.get("data").addressProfileTrack;i&&(i.GA.label=n,i.MD.data.label=n,t.Track.analyticsEvent(i.GA),t.Track.melidataEvent(i.MD))},onFormSubmit:function(e){var n=this;e.preventDefault(),this.trigger("beginSave"),this.isFormValid()?(this.addOutputToFlow(),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")):this.trigger("flowSaved")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.DeliveryInstructions=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shared.inputsPage._inputsPage,'[data-component="delivery-instructions"]')},ui:{formContainer:'[data-js="delivery-instructions-form-container"]',submitButton:'[data-js="submit-btn"]',cancelButton:'[data-js="cancel-btn"]',form:'[data-js="form-container"]'},events:{"click @ui.submitButton":"onFormSubmit","click @ui.cancelButton":"onFormCancel"},behaviors:function(){var e=this.options.model.get("data"),n=e.stepContext;return{Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,inputs:this.options.model.get("inputs"),submitButtonText:n.submitButtonText,formId:"delivery-instructions-info-form",hideSubmitButton:!0,classList:"ui-panel--raised delivery-instructions--panel"},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},templateHelpers:function(){return{id:"delivery-instructions",containerModifiers:"",transparentButton:!0}},addOutputToFlow:function(e){var n=this.options.model.get("inputs"),i=n[e],o=this.getInputModel(n.delivery_instructions.id);t.channels.flow.trigger("output:add",{key:i.output,value:i.output}),t.channels.flow.trigger("output:add",{key:o.get("output"),value:o.get("data.value")})},onFormSubmit:function(e){e.preventDefault(),this.trigger("beginSave"),this.isFormValid()?(this.addOutputToFlow("saveDeliveryInstructions"),this.saveInfo()):this.trigger("flowSaved")},onFormCancel:function(e){e.preventDefault(),this.trigger("beginSave"),this.addOutputToFlow("cancelDeliveryInstructions"),this.saveInfo()},saveInfo:function(){var e=this;t.channels.flow.once("saved",function(){e.trigger("flowSaved")}),t.channels.flow.trigger("save")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i,o){e.HubAddressesLayout=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.hubAddresses,'[data-component="hub-addresses"]')},behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:""},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepEdit"],trackIfPresent:!0}},ui:{errorMessage:'[data-js="ui-list__error"]',submitButton:'[data-js="submit-button"]',newAddressButton:'[data-js="new-address-button"]',addressesRegion:'[data-js="hub-addresses"]',buttonsSection:'[data-js="buttons-section"]'},regions:{addressesRegion:"@ui.addressesRegion"},events:{"click @ui.submitButton":"handleClickSubmit","click @ui.newAddressButton":"handleClickNewAddress"},onShow:function(){this.renderAddressOptions(),this.bindEvents()},bindEvents:function(){this.hubAddressesView.on("editAddressButtonClick",this.onEditAddressButtonClick.bind(this)),this.hubAddressesView.on("addDeliveryInstructionButtonClick",this.onAddDeliveryInstructionButtonClick.bind(this))},onEditAddressButtonClick:function(e){this.goToStep("nextStepEdit",e.model.get("id"))},onAddDeliveryInstructionButtonClick:function(e){this.goToStep("nextStepDelivery",e.model.get("id"))},handleClickSubmit:function(e){e.preventDefault();var t=this.getSelectedOption();if(t){var n=t.model.get("id");this.goToStep("nextStepContinue",n)}},handleClickNewAddress:function(e){e.preventDefault();var t=this.getSelectedOption();if(t){var n=t.model.get("id");this.goToStep("nextStepAddAddressHub",n)}},renderAddressOptions:function(){var t=this.model.get("data.addressHubList");this.hubAddressesView=new e.HubAddressesCollection({collection:this.collection,editAddressText:t.editAddressText,deliveryInstructionText:t.deliveryInstructionText}),this.getRegion("addressesRegion").show(this.hubAddressesView),this.setPreselectedOption(),this.contentHeight=o("#app-container").height()},setPreselectedOption:function(){return this.hubAddressesView.setPreselectedOption()},getSelectedOption:function(){return this.hubAddressesView.getSelectedOption()},goToStep:function(e,n){var i=this;this.trigger("beginSave");var o=this.model.get("inputs."+e),s=this.model.get("inputs.addressId");o&&t.channels.flow.trigger("output:add",{key:o.output,value:o.output}),s&&t.channels.flow.trigger("output:add",{key:s.output,value:n}),t.channels.flow.once("saved",function(){i.trigger("flowSaved")}),t.channels.flow.trigger("save")},unbindScrollEvents:function(){o(window).off("scroll")},onDestroy:function(){this.unbindScrollEvents()}})}),App.module("Checkout.UserContact.Views",function(e,t,n,i,o,s){e.UserContact=i.LayoutView.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.userContactInfo,'[data-component="user-contact"]')},ui:{formContainer:'[data-js="user-contact-form-container"]',submitButton:'[data-js="submit-btn"]',form:'[data-js="form-container"]'},events:{"submit @ui.form":"onFormSubmit","click @ui.submitButton":"onFormSubmit"},behaviors:function(){var e=this.options.model.get("data"),n=e.stepContext,i=t.Config.device,o="desktop"===i;return{Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,isNavigable:!1,inputs:this.options.model.get("inputs"),submitButtonText:n.submitButtonText,formId:"user-contact-info-form",hideSubmitButton:o,classList:o?"ui-panel--raised":"",requiredDataText:o?n.requireText:null},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}}},addOutputsToFlow:function(){var e=this.getInputCollection(),n=e.map(function(e){var t=e.get("data.value"),n=e.get("output");return{id:n,output:t}});t.channels.flow.trigger("output:add",n),this.trackAddressProfile(n)},trackAddressProfile:function(e){var n=s.findWhere(e,{id:"addressProfile"});this.addressProfileValue=n?n.output:null;var i=this.options.model.get("data").addressProfileTrack;i&&this.addressProfileValue&&(i.GA.label=this.addressProfileValue,i.MD.data.label=this.addressProfileValue,t.Track.analyticsEvent(i.GA),t.Track.melidataEvent(i.MD))},onFormSubmit:function(e){var n=this;e.preventDefault(),this.trigger("beginSave"),this.isFormValid()?(this.addOutputsToFlow(),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")):this.trigger("flowSaved")}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.SplitPaymentsList=i.CollectionView.extend({tagName:"ul",className:"split-payment-list",childView:e.SplitPaymentDetail,childViewOptions:function(){return{containerTagName:"li"}}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.PaymentTypesList=i.CollectionView.extend({tagName:"ul",className:"badge-type-selection__list ui-list-card",childView:e.PaymentType,initialize:function(e){this.childViewOptions=Object.assign(e.childViewOptions||{},{inputs:e.inputs})}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.PaymentMethodsList=i.CollectionView.extend({tagName:"ul",className:function(){var e="cardIssuerId"===this.options.output?"payment-method-selection__menu ui-list ui-panel--raised":"badge-type-selection__list",n=t.Config.device;return e="mobile"!==n?e:e.concat(" ui-list-card")},childView:e.PaymentMethod,initialize:function(e){this.childViewOptions={output:e.output}},collectionEvents:{change:"render"},childEvents:{"radio:click":"handleClick"},handleClick:function(e){this.trigger("radioClick"),e.model.set("selected",!0);var t=this.children.filter(function(t){return t.model!==e.model});t.forEach(function(e){e.model.set("selected",!1)})}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.Installments=i.CollectionView.extend({defaults:{isModalView:!0},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._installments,'[data-component="installments"]')},tagName:"ul",className:function(){var e="ui-list installments-list installments-list--discount",n=t.channels.flow.request("step:data").data,i=n.footer&&n.footer.discount?e:"ui-list installments-list";return i},childView:e.Installment,behaviors:function o(){var o={};return this.options.disableViewTracking||(o.TrackingInputs={behaviorClass:t.Behaviors.TrackingInputs,inputs:["installmentsSelection"],trackIfPresent:!0}),o},hasSelectedInstallment:function(){return this.collection.findWhere({selected:!0})},childViewOptions:function(){return{withoutFeeText:this.options.withoutFeeText,withoutFee:this.options.withoutFee,paymentId:this.options.paymentId,showChevron:this.options.showChevron,chevronClasses:this.options.chevronClasses,showChevronIfSelected:this.options.showChevronIfSelected,isModalView:this.options.isModalView}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.Addresses=i.CollectionView.extend({childView:e.Address,tagName:"ul",className:"ui-list__content address-card-ui-list__content",behaviors:function(){return{TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["addressId"]}}},childViewOptions:function(){return{className:"address-card-ui-list__item ui-list__item ui-list__item--action",tagName:"li"}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.CartPackages=i.CollectionView.extend({childView:e.Package,tagName:"ul",className:"cart-packages",getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._cartPackages,'[data-component="cart-packages"]')},initialize:function(e){this.childViewOptions={data:e.model.get("data")}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ContactsList=i.CollectionView.extend({tagName:"ul",className:"badge-type-selection__list",childView:e.Contact})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.SelectionListItems=i.CollectionView.extend({tagName:"ul",className:function(){var e="selection-list__menu ui-list ui-panel--raised",n=t.Config.device;return e="mobile"!==n?e:e.concat(" ui-list-card")},childView:e.SelectionListItem,initialize:function(e){this.childViewOptions={output:e.output}},collectionEvents:{change:"render"},childEvents:{"radio:click":"handleClick"},handleClick:function(e){var t=this.children.filter(function(e){return e.model.get("selected")===!0})[0];t&&t.model.set("selected",!1),e.model.set("selected",!0),this.trigger("radioClick")}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingOptions=i.CompositeView.extend({template:t.Checkout.templates.components.shipping._shippingOptionContainer,childViewContainer:'[data-js="shipping-options-list"]',childView:e.ShippingOption,collectionEvents:{change:"render"},templateHelpers:function(){return{subtitle:this.options.subtitle}},behaviors:function o(){var o={};return(this.options.isModalView||this.options.hasToBeTrackedOutsideOfModalView)&&(o.TrackingInputs={behaviorClass:t.Behaviors.TrackingInputs,inputs:["selectedShippingOption"]}),o},childViewOptions:function(){return{packageId:this.options.packageId,shippingOptionsSelectionView:this.options.shippingOptionsSelectionView,isModalView:this.options.isModalView,inCollection:!0,hideChevron:this.options.hideChevron,autoRipple:this.options.autoRipple}}})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.HubAddressesCollection=i.CollectionView.extend({tagName:"ul",childView:e.HubAddresses,initialize:function(e){this.childViewOptions={editAddressText:e.editAddressText,deliveryInstructionText:e.deliveryInstructionText}},collectionEvents:{change:"render"},childEvents:{addressCardFormClick:"handleAddressCardFormClick",editAddressButtonClick:"handleEditAddressButtonClick",addDeliveryInstructionButtonClick:"handleAddDeliveryInstructionButtonClick"},getSelectedOption:function(){return this.children.filter(function(e){return e.model.get("selected")===!0})[0]},setPreselectedOption:function(){var e=this.getSelectedOption();e||this.children.first().model.set("selected",!0)},handleAddressCardFormClick:function(e){e.model.set("selected",!0);var t=this.children.filter(function(t){return t.model!==e.model});t.forEach(function(e){e.model.set("selected",!1)})},handleEditAddressButtonClick:function(e){this.trigger("editAddressButtonClick",e)},handleAddDeliveryInstructionButtonClick:function(e){this.trigger("addDeliveryInstructionButtonClick",e)}})}),App.module("Checkout.Congrats.Views",function(e,t){t.extendView(e.CongratsAgenciesOffMapLayout,{buildModel:function(){var e=t.channels.flow.request("step:data"),n=new Backbone.DeepModel(e);return n.set("data.searchBoxInSide",!0),n.set("data.infoBox",!0),n.set("data.sidebar",!0),n}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){t.extendView(e.PaymentMethod,{className:function(){return"cardIssuerId"===this.options.output?this.model.get("selected")?"payment-method__menu-item ui-list__item ui-list__item--selected":"payment-method__menu-item ui-list__item":this.model.get("selected")?"badge-type-selection__list-item ui-list__item ui-list__item--selected":"badge-type-selection__list-item ui-list__item"},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._paymentMethodWithRadioButton,'[data-js="payment-method"]')},attributes:function(){return{"aria-checked":this.model.get("selected")}},ui:{installmentItem:".ui-radio__label"},triggers:{"click @ui.installmentItem":"radio:click"},onShow:function(){this.model.get("selected")&&this.$el.find("input").focus()}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t,n,i){e.InstallmentWithRadioButton=t.Checkout.Payments.Views.Installment.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._installmentWithRadioButton,'[data-component="installment"]')},attributes:function(){return{"aria-checked":this.model.get("selected")}},ui:{installmentItem:".ui-radio__label:not(.payment-split-header)"},triggers:{"click @ui.installmentItem":"radio:click"},onShow:function(){this.model.get("selected")&&this.$el.find("input").focus()}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.PaymentType,{tagName:"li",className:function(){return this.model.get("selected")?"badge-type-selection__list-item ui-list__item ui-list__item--selected":"badge-type-selection__list-item ui-list__item"},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.payments._paymentTypeWithRadioButton,'[data-js = "payment-type"]')},attributes:function(){return{"aria-checked":this.model.get("selected")}},ui:{paymentTypeItem:".ui-radio__label"},triggers:{"click @ui.paymentTypeItem":"radio:click"},onShow:function(){this.model.get("selected")&&this.$el.find("input").focus()}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t){var n="name";t.extendView(e.UserIdentification,{getNaturalNamePlaceholder:function(){return n},onInputError:function(){},behaviors:function i(){var e=this.getStepInputs(),n=this.options.model.get("data"),o=n.userIdentificationContext.preloadedDataMessage,i={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,submitButtonText:n.stepContext.submitButtonText,hasCard:!0,inputs:e,prependMessage:o},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}};return window.requestAnimationFrame||(i.FormatlessPaste={behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["docNumber"],validMaskRegex:/[^0-9]/g}),i}},{behaviorsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.SplitPaymentDetail,{regions:{installmentsList:'[data-js="installments-list"]'},ui:{chevron:".ui-icon--chevron",installmentSelectionForm:'[data-js="installment-selection-form"]'
},behaviors:function(){return{TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs},Expandable:{behaviorClass:t.Behaviors.Expandable,collapsibleElementsSelector:'[data-js="installments-list"] li, .installment-selection-form',clickCallBack:this.expandableClickCallback,clickCallbackOptions:{thisInstance:this,$el:this.$el}}}},expandableClickCallback:function(e,t,n){var i=e.currentTarget.getAttribute("class");t?(this.clickCallbackOptions.thisInstance.$el.find(".ui-radio__label").removeClass("payment-split-header"),n.thisInstance.triggerMethod("customTrack",{event:"click",inputName:"nextStepInstallment"})):i.match("ui-list")&&!i.match("selected")?(this.clickCallbackOptions.thisInstance.$el.find(".ui-radio__label").addClass("payment-split-header"),n.thisInstance.triggerMethod("customTrack",{event:"click",inputName:"installmentsSelection"})):this.clickCallbackOptions.thisInstance.$el.find(".ui-radio__label").addClass("payment-split-header")},getSelectInstallmentSubmitHandler:function(){return"preventDefaultBehavior"},getChevronClasses:function(){return"ui-icon--chevron--down"},onShow:function(){this.headerImageSize=36,this.dataConfig=this.getDataConfig(),this.renderPaymentDetailHeader(),this.renderSelectInstallmentView({disableViewTracking:!0}),this.renderInstallmentList(),this.hideSelectInstallmentViewIfNecessary()},hideSelectInstallmentViewIfNecessary:function(){var e=this.installmentsListViewInstance.hasSelectedInstallment();e&&this.ui.installmentSelectionForm.removeClass("selected")},getInstallmentModel:function(){return Object.assign({},this.dataConfig.currentPaymentData.selectedInstallment,{selected:!0})},getInstallmentsListChevronConfig:function(e){e.showChevron=!1,e.showChevronIfSelected=!0},renderInstallmentList:function(){this.installmentsListViewInstance=this.getInstallmentsCollectionView({disableViewTracking:!0}),this.getRegion("installmentsList").show(this.installmentsListViewInstance),this.installmentsListViewInstance.on("radioClick",this.onRadioClick.bind(this))},onRadioClick:function(){var e=this.installmentsListViewInstance.children.filter(function(e){return e.model.get("selected")===!0})[0];e.saveInstallment()}})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.PaymentTypeLayout,{ui:{storedPaymentTypes:'[data-js="payments-types"][data-stored="true"]',paymentsTypesRegion:'[data-js="payments-types"][data-stored="false"]',externalWalletsRegion:'[data-js="payments-types"][data-external-wallet="true"]',submitButton:'[data-js="list-submit"]',errorMessage:'[data-js="ui-list__error"]'},regions:{storedPaymentTypes:"@ui.storedPaymentTypes",paymentsTypesRegion:"@ui.paymentsTypesRegion",externalWalletsRegion:"@ui.externalWalletsRegion"},events:{"click @ui.submitButton":"handleClickSend"},onRadioClick:function(e){this.collectionViewWithSelectedOption=e;var t=this.paymentsCollectionViews.filter(function(t){return t!==e});t.forEach(function(e){e.unSelectAllOptions()}),this.hideListError()},showListError:function(){this.ui.storedPaymentTypes.addClass("ui-options-container--error"),this.ui.paymentsTypesRegion.addClass("ui-options-container--error"),this.ui.externalWalletsRegion.addClass("ui-options-container--error"),this.ui.errorMessage.removeClass("ui-list__error-hidden")},hideListError:function(){this.ui.storedPaymentTypes.removeClass("ui-options-container--error"),this.ui.paymentsTypesRegion.removeClass("ui-options-container--error"),this.ui.externalWalletsRegion.removeClass("ui-options-container--error"),this.ui.errorMessage.addClass("ui-list__error-hidden")},handleClickSend:function(e){if(e.preventDefault(),!this.collectionViewWithSelectedOption)return this.showListError(),!1;var t=this.collectionViewWithSelectedOption.children.filter(function(e){return e.model.get("selected")===!0})[0],n=t.$el.find('[data-js="payment-type-id"]'),i=t.$el.find('[data-js="payment-type-card-id"]'),o=t.$el.find('[data-js="payment-type"]'),s=this.model.get("data").accountMoneyContext||null,a=t.$el.find('[data-js="payment-method-group-id"]'),r=t.$el.find('[data-js="payment-type-name"]'),d=this.model.get("data").storedCards,l=r&&d&&Array.isArray(d)?d.filter(function(e){return e.trackingName===r.val()}):null,u=l&&l.length>0?l[0]:null,c=u&&u.trackInfo&&u.trackInfo.events?u.trackInfo.events[0]:null;this.submitValues={id:n?n.val():null,cardId:i?i.val():null,type:o.val(),accountMoneyData:s,groupId:a?a.val():null,trackInfo:c},s&&s.useAccountMoney?this.showConfirmIfNeeded():this.send(this.submitValues)}})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.PaymentSplit,{regions:{paymentInfoContainer:'[data-js="payment-info-container"]'},bindEvents:function(){t.channels.core.on("ui-message:closed",this.handleUIMessageClosed.bind(this))},handleUIMessageClosed:function(){this.renderHeroView()},renderSplitMessageView:function(){var e=this.model.get("data");this.getRegion("paymentInfoContainer").show(new t.Checkout.Views.UIMessage({model:new Backbone.Model({title:this.model.get("data").modalHeaderTitle,subtitle:e.subtitle,iconId:e.selectedPayment.icon,paymentId:e.selectedPayment.id}),trackingCloseInputName:"closeSplitMessage"}))},renderSummaryComponent:function(){var e=this.model.get("data");this.summaryComponentView=new t.Checkout.Views.SummaryComponent({model:new t.Checkout.Models.FooterComponent({dataFooter:e.footer}),actionButton:!0,buttonText:e.stepContext.submitButtonText,disabled:!1,showErrorMessage:!0,errorText:e.stepContext.errorText}),this.getRegion("summaryComponent").show(this.summaryComponentView)},renderHeroView:function(){this.addNeededRegions();var e=this.model.get("inputs").nextStepPayments,n=this.model.get("data").selectedPayment;this.getRegion("paymentInfoContainer").show(new t.Checkout.Views.Hero({model:new Backbone.Model({heroData:n}),iconId:n.icon,buttonName:e.output,buttonValue:e.output,buttonDataId:e.id,formDataJs:"change-payment",logoSize:"cho_badge"}))},renderAdequateMessage:function(){var e=0===this.checkNotSelectedInstallment().count;t.Checkout.Views.UIMessage.hasBeenClosed||e?this.renderHeroView():this.renderSplitMessageView()},addNeededRegions:function(){this.addRegions(this.regions)},expandInstallments:function(e){e.parent("li").hasClass("expandable--collapsed")&&e.find(".select-installment").trigger("click")},onShow:function(){this.bindEvents(),this.renderAdequateMessage(),this.renderSplitPaymentsList(),this.renderSummaryComponent(),this.expandNotSelectedInstallment()},expandNotSelectedInstallment:function(){var e=this.checkNotSelectedInstallment().count;1===e&&this.focusInstallment(this.checkNotSelectedInstallment(),.5,this.expandInstallments)},showListError:function(e){e.find(".split-payment__inner-wrapper").addClass("split-payment__inner-wrapper--error"),e.find(".installments-list").addClass("ui-options-container--error"),this.summaryComponentView.ui.errorMessage.removeClass("ui-list__error-hidden")},addErrorAnimation:function(e,t){if(this.expandInstallments(e),this.showListError(e),t.count>1){var n=this.getRegion("splitPaymentsList").$el.find(".split-payment")[1];this.showListError($(n))}},send:function(e){var n=this;e.preventDefault();var i=this.model.get("data");i.installmentsReady?(this.trigger("beginSave"),t.channels.flow.once("saved",function(){n.trigger("flowSaved")}),t.channels.flow.trigger("save")):this.focusInstallment(this.checkNotSelectedInstallment(),.5,this.addErrorAnimation.bind(this))},onBeforeDestroy:function(){t.channels.core.off("ui-message:closed")}})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.PaymentMethodsLayout,{ui:{hero:'[data-component="hero"]',errorMessage:'[data-js="ui-list__error"]',submitButton:'[data-js="list-submit"]'},regions:{hero:"@ui.hero"},events:{"click @ui.submitButton":"handleClickSend"},onShow:function(){this.renderPaymentMethods(),this.bindRadioClickEvent(),this.setHero()},setHero:function(){var e=this.model.get("data").selectedPayment,n=this.model.get("inputs").nextStepPayments;e||t.Checkout.ErrorService["throw"](new MissingDataError({method:"setHero()",missingKey:"selectedPayment",context:this,type:MissingDataError.type.DATA,reason:'Cannot set hero data without "selectedPayment" value',severity:t.Checkout.ErrorService.severity.WARNING}));var i=new Backbone.Model({heroData:e}),o=new t.Checkout.Views.Hero({model:i,iconId:e.icon,buttonName:n.output,buttonValue:n.output,buttonDataId:n.id,formDataJs:"change-payment",logoSize:"cho_badge"});this.getRegion("hero")&&this.getRegion("hero").show(o)},bindRadioClickEvent:function(){this.paymentMethodsView.on("radioClick",this.onRadioClick.bind(this))},onRadioClick:function(){this.hideListError()},showListError:function(){this.ui.paymentMethodsRegion.addClass("ui-options-container--error"),this.ui.errorMessage.removeClass("ui-list__error-hidden")},hideListError:function(){this.ui.paymentMethodsRegion.removeClass("ui-options-container--error"),this.ui.errorMessage.addClass("ui-list__error-hidden")},handleClickSend:function(e){e.preventDefault();var t=this.paymentMethodsView.children.filter(function(e){return e.model.get("selected")===!0})[0];return t?void t.send(t.model.get("id")):(this.showListError(),!1)}})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.InstallmentsLayout,{ui:{heading:'[data-js="stepTitle-heading"]',hero:'[data-component="hero"]',errorMessage:'[data-js="ui-list__error"]',submitButton:'[data-js="list-submit"]'},regions:{hero:"@ui.hero"},events:{"click @ui.submitButton":"handleClickSend"},onShow:function(){this.renderInstallmentsList(),this.bindRadioClickEvent(),this.setHero(),this.focusHeading()},focusHeading:function(){this.ui.heading.focus()},setHero:function(){var e=this.model.get("data").selectedPayment,n=this.model.get("inputs").nextStepPayments;e||t.Checkout.ErrorService["throw"](new MissingDataError({method:"setHero()",missingKey:"selectedPayment",context:this,type:MissingDataError.type.DATA,reason:'Cannot set hero data without "selectedPayment" value',severity:t.Checkout.ErrorService.severity.WARNING}));var i=new Backbone.Model({heroData:e}),o=new t.Checkout.Views.Hero({model:i,iconId:e.icon,buttonName:n.output,buttonValue:n.output,buttonDataId:n.id,formDataJs:"change-payment",logoSize:"cho_badge"});this.getRegion("hero")&&this.getRegion("hero").show(o)},bindRadioClickEvent:function(){this.installmentsCollectionView&&this.installmentsCollectionView.on("radioClick",this.onRadioClick.bind(this))},onRadioClick:function(){this.hideListError()},showListError:function(){this.ui.installmentsList.addClass("ui-options-container--error"),this.ui.errorMessage.removeClass("ui-list__error-hidden")},hideListError:function(){this.ui.installmentsList.removeClass("ui-options-container--error"),this.ui.errorMessage.addClass("ui-list__error-hidden")},handleClickSend:function(e){if(e.preventDefault(),this.installmentsCollectionView){var t=this.installmentsCollectionView.children.filter(function(e){return e.model.get("selected")===!0})[0];if(!t)return this.showListError(),!1;t.saveInstallment()}}})}),App.module("Checkout.Payments.Views",function(e,t,n){t.extendView(e.CardForm,{ui:{hero:'[data-component="hero"]',submitButton:'[data-js="submit-btn"]'},regions:{hero:"@ui.hero"},events:{"click @ui.submitButton":"onFormSubmit"},behaviors:function i(){var e=this.getStepInputs(),i={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,hasCard:!0,submitButtonText:this.options.model.get("data").stepContext.submitButtonText,inputs:e},BinHelper:{behaviorClass:t.Checkout.Behaviors.NewCard},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["callGateway","iframeLoading"],hideOn:["gatewayTransactionCompleted","gatewayTransactionFailed","invalidDataFound","iframeLoaded"]},Biometrics:{behaviorClass:t.Checkout.Behaviors.Biometrics,keyboardForm:'[data-component="new-card"] form[data-js="form-container"]',keyboardSensitive:'input[name="card_number"], input[name="expiration_date"], input[name="security_code"]'},BankDeals:{behaviorClass:t.Behaviors.BankDeals},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["bankDeals"],trackIfPresent:!0}};return window.requestAnimationFrame||(i.FormatlessPaste={behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["cardNumber","expirationDate","userIdentificationNumber"],validMaskRegex:/[^0-9]/g}),i},initialize:function(){this.on("gatewayTransactionSuccessful",function(){return t.channels.core.trigger("snackbar:close")})},onShow:function(){this.bindEvents(),this.setHero()},setHero:function(){var e=this.model.get("data").selectedPayment,i=this.model.get("inputs").nextStepPayments;if(!e)return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"setHero()",missingKey:"selectedPayment",context:this,type:MissingDataError.type.DATA,reason:'Cannot set hero data without "selectedPayment" value',severity:t.Checkout.ErrorService.severity.WARNING}));if(!i)return void t.Checkout.ErrorService["throw"](new MissingDataError({method:"setHero()",missingKey:"nextStepPayments",context:this,type:MissingDataError.type.INPUT,reason:'Cannot set hero data without "nextStepPayments" value',severity:t.Checkout.ErrorService.severity.WARNING}));var o=new n.Model({heroData:e}),s=new t.Checkout.Views.Hero({model:o,iconId:e.icon,buttonName:i.output,buttonValue:i.output,buttonDataId:i.id,formDataJs:"change-payment",logoSize:"cho_badge"});this.getRegion("hero")&&this.getRegion("hero").show(s)},handleStoredCardIfNeeded:function(){if(this.isOnlySecurityCodeStep()){var e=this.model.get("data"),t="securityCode";this.setStoredCardBrand(e),this.focusInputDOMElement(t),this.configureStoredCardOwnerName(e),this.configureStoredCardNumber(e),this.configureStoredCardExpirationDate(e)}},focusInputDOMElement:function(e){var t=this.getInputModelById(e),n=this.getInputViewByModel(t),i=this.getInputDOMElement(n);i.focus()},handleErroredInput:function(e){this.focusInputDOMElement(e)},onFormSubmit:function(e){e.preventDefault(),this.handleSubmit()}},{behaviorsOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t,n){t.extendView(e.ExpiredEscSecurityCode,{ui:{submitButton:'[data-js="submit-btn"]'},behaviors:function i(){var e=this.getStepInputs(),n=this.options.model.get("data").stepContext,i={Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,isNavigable:!1,hasCard:!0,hideSubmitButton:!0,formId:"expired-esc-form",submitButtonText:this.options.model.get("data").stepContext.submitButtonText,inputs:e,panelRaised:!1},BinHelper:{behaviorClass:t.Checkout.Behaviors.NewCard,hasToRedirect:!1},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:["beginSave"],hideOn:["gatewayTransactionCompleted","gatewayTransactionFailed","invalidDataFound","iframeLoaded"]},Biometrics:{behaviorClass:t.Checkout.Behaviors.Biometrics,keyboardForm:'[data-component="expired-esc"] form[data-js="form-container"]',keyboardSensitive:'input[name="card_number"], input[name="expiration_date"], input[name="security_code"]'},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["bankDeals"],trackIfPresent:!0}};return window.requestAnimationFrame||(i.FormatlessPaste={behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["cardNumber","expirationDate","userIdentificationNumber"],validMaskRegex:/[^0-9]/g}),n&&(i.AnimationReviewCongrats={behaviorClass:t.Behaviors.AnimationReviewCongrats,transitionText:n.loadingButtonText,confirmText:n.submitButtonText,hasToSave:!1}),i},initialize:function(){this.on("gatewayTransactionSuccessful",function(){return t.channels.core.trigger("snackbar:close")});var e=this.model.get("data"),n=e.requireEsc,i=e.lastFourDigits,o=e.firstSixDigits,s=e.cardId;new t.Checkout.ESC({requireEsc:n,sessionId:t.Config.escId}).removeStoredEscForCard({lastFourDigits:i,firstSixDigits:o,cardId:s})},onShow:function(){this.bindEvents()},handleStoredCardIfNeeded:function(){if(this.isOnlySecurityCodeStep()){var e="securityCode",t=this.model.get("data");this.setStoredCardBrand(t),this.focusInputDOMElement(e),this.configureStoredCardOwnerName(t),this.configureStoredCardNumber(t),this.configureStoredCardExpirationDate(t)}},focusInputDOMElement:function(e){var t=this.getInputModelById(e),n=this.getInputViewByModel(t),i=this.getInputDOMElement(n);i.focus()},handleErroredInput:function(e){this.focusInputDOMElement(e)}},{behaviorsOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t){t.extendView(e.BillingInfoForm,{onUpdateZipCode:function(e){var t=e.hasError,n=e.stepData,i=n.inputs;if(this.updateZipCode(e),!t){if(i.state){var o=this.getInputModelById(i.state.id);o.set("data.value",i.state.data.value)}if(i.city){var s=this.getInputModelById(i.city.id);s.set("data.value",i.city.data.value)}}}})}),App.module("Checkout.Payments.Views",function(e,t,n,i){t.extendView(e.PaymentTypesList,{tagName:"ul",className:"badge-type-selection__list",childView:e.PaymentType,initialize:function(e){this.childViewOptions=Object.assign(e.childViewOptions||{},{inputs:e.inputs})},collectionEvents:{change:"render"},childEvents:{"radio:click":"handleClick"},handleClick:function(e){this.trigger("radioClick"),e.model.set("selected",!0);var t=this.children.filter(function(t){return t.model!==e.model});t.forEach(function(e){e.model.set("selected",!1)})},unSelectAllOptions:function(){this.children.forEach(function(e){e.model.set("selected",!1)})}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Payments.Views",function(e,t,n,i){t.extendView(e.Installments,{collectionEvents:{change:"render"},childEvents:{"radio:click":"handleClick"},getChildView:function(){return this.options.isModalView?e.Installment:e.InstallmentWithRadioButton},handleClick:function(e){var t=this.children.filter(function(e){return e.model.get("selected")===!0})[0];t&&t.model.set("selected",!1),e.model.set("selected",!0),this.trigger("radioClick")}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Review.Views",function(e,t){t.extendView(e.Review,{behaviors:{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"},ShippingOptionsCaller:{behaviorClass:t.Checkout.Behaviors.ShippingOptionsCaller,isModal:!0},AddressSelectionCaller:{behaviorClass:t.Checkout.Behaviors.AddressSelectionCaller,isModal:!0},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepShippingOption","nextStepInstallment","nextStepAddressChange"],trackIfPresent:!0}},onShow:function(){this.renderPaymentsHero(),this.renderBillingInfoHero(),this.showAccountMoneyOptOutModalIfNeeded(),this.focusHeading()},focusHeading:function(){this.ui.heading.focus()},getInstallmentModalHeader:function(){return this.getSingleInstallmentModalHeader()}},{behaviorsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){e.ShippingOptionWithRadioButton=t.Checkout.Shipping.Views.ShippingOption.extend({getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._shippingOptionWithRadioButton,'[data-component="shipping-option"]')},attributes:function(){return{"aria-checked":this.model.get("selected")}},ui:{shippingOptionsItem:".ui-radio__label:not(.cart-shipping-options-header)"},triggers:{"click @ui.shippingOptionsItem":"radio:click"},onShow:function(){this.model.get("selected")&&this.$el.find("input").focus()}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){t.extendView(e.SelectionListItem,{className:function(){return this.model.get("selected")?"selection-list__menu-item ui-list__item ui-list__item--selected":"selection-list__menu-item ui-list__item"},getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.components.shipping._selectionListItemWithRadioButton,'[data-js="selection-list-item-wrapper"]')},attributes:function(){return{"aria-checked":this.model.get("selected")}},ui:{selectionListItem:".ui-radio__label"},triggers:{"click @ui.selectionListItem":"radio:click"},onShow:function(){this.model.get("selected")&&this.$el.find("input").focus()}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t){t.extendView(e.AddressForm,{ui:{stateInput:'[data-input-id="state"]'},events:{"blur @ui.zipCodeInput":"onZipCodeBlur"},onShow:function(){this.bindEvents(),setTimeout(this.onZipCodePreloaded.bind(this),100)},bindEvents:function(){this.on("input:value:changed",this.onInputValueChanged.bind(this))},behaviors:function(){var e=this.getStepInputs(),n=this.options.model.get("data");return{Form:{behaviorClass:t.Checkout.Form.Behaviors.Form,formContainer:this.ui.formContainer,inputs:e,classList:"ui-panel--raised",submitButtonText:n.stepContext.submitButtonText,requiredDataText:n.destinationContext?n.destinationContext.requiredDataLabelText:null},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["unknownZipCodeLink"],trackIfPresent:!0},FormatlessPaste:{behaviorClass:t.Checkout.Behaviors.FormatlessPaste,inputs:["zipCode"],validMaskRegex:/[^0-9]/g}}},onInputValueChanged:function(e){var t=e.model,n=t.get("id"),i=this.getInputModelById("nextStepFetchCities"),o=this.getInputModelById("nextStepValidateCity");"state"===n&&i&&this.onStateChanged(i),"city"===n&&o&&this.onCityChanged(o)},onZipCodePreloaded:function(){var e=t.channels.flow.request("step:data"),n=e.inputs;if(n.zipCode){var i=this.getInputModelById(n.zipCode.id),o=i.get("data.value");o&&this.onZipCodeBlur()}},onStateChanged:function(e){var n=t.channels.flow.request("step:data"),i=n.inputs,o=this.getInputModelById(i.state.id),s=this.getInputModelById(i.city.id);s.set("data.value",""),s.set("error",null),s.removeConstraint("invalidRemoteConstraint",!1),s.removeConstraint("nonEquals",!1),s.setAspectModel("loadingAspect"),t.channels.flow.trigger("output:add",{key:o.get("output"),value:o.get("data.value")}),t.channels.flow.trigger("output:add",{key:e.get("output"),value:!0}),t.channels.flow.once("saved",function(){s.resetAspectModel()}),t.channels.flow.trigger("save")},onCityChanged:function(e){this.el=$('[data-js="validation-message-city"]');var n=t.channels.flow.request("step:data"),i=n.inputs,o=this.getInputModelById(i.city.id),s=this.getInputModelById(i.state.id),a=o.get("data.label"),r=s.get("data.label");"RM (Metropolitana)"===r&&"Santiago"===a?(o.set("data.prompt","Santiago hace referencia a la comuna Santiago Centro"),this.el.addClass("ui-form__message-prompt")):this.el.removeClass("ui-form__message-prompt"),t.channels.flow.trigger("output:add",{key:o.get("output"),value:o.get("data.label")}),t.channels.flow.trigger("output:add",{key:e.get("output"),value:!0}),t.channels.flow.trigger("save")},onUpdateCity:function(e){var t=e.stepData,n=t.inputs;if(n.city){var i=this.getInputModelById(n.city.id);i.set("data.options",{}),i.set("data.options",n.city.data.options),this.validateCityInconsistency(e)}},validateCityInconsistency:function(e){var t=e.stepData,n=t.inputs,i=this.getInputModelById(n.city.id),o=n.city.error;o?(i.addConstraint({name:"nonEquals",value:i.get("data.value"),errorMessage:o}),i.addConstraint({name:"invalidRemoteConstraint",errorMessage:o},!0)):(i.removeConstraint("invalidRemoteConstraint",!1),i.removeConstraint("nonEquals",!1))}},{behaviorsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t,n){t.extendView(e.Package,{ui:{shippingOptions:'[data-js="cart-package__shipping"]'},className:"cart-package",regions:{shippingOptions:"@ui.shippingOptions"},behaviors:function(){return{Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"},ShippingOptionsCaller:{behaviorClass:t.Checkout.Behaviors.ShippingOptionsCaller,isModal:!0,inputs:this.options.inputs},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs}}},initialize:function(){this.expandableDelay=300},setShippingOptionsHeaderView:function(){var e=t.channels.flow.request("step:data").data,i={title:e.packsConfigsContext.changeShippingText,chevron:!0,chevronClasses:"ui-icon--chevron--up"},o=new n.Model(i);this.shippingOptionsHeaderView=new t.Checkout.Views.ListHeader({model:o})},displayShippingOptions:function(){this.$el.addClass("cart-packages__expandable");var e=new t.Checkout.Views.ContentWrapper({headerView:this.shippingOptionsHeaderView,contentView:this.shippingOptionsCollectionView,behaviors:{Expandable:{behaviorClass:t.Behaviors.Expandable,collapsibleElementsSelector:'li, [data-js="content-wrapper-header"]',collapseCallback:this.setClassMainElement,collapseCallbackOptions:{$el:this.$el,isExpanded:!1},expandCallback:this.setClassMainElement,expandCallbackOptions:{$el:this.$el,isExpanded:!0},clickCallBack:this.expandableClickCallback.bind(this),clickCallbackOptions:{thisInstance:this,$el:this.$el},delay:{duration:this.expandableDelay,direction:"collapsed"}}}});this.getRegion("shippingOptions").show(e)},expandableClickCallback:function(e,t,n){var i=e.currentTarget.getAttribute("class");t?(this.$el.find(".ui-radio__label").removeClass("cart-shipping-options-header"),n.$el.addClass("cart-packages__expandable--animate"),n.thisInstance.triggerMethod("customTrack",{event:"click",inputName:"nextStepShippingOption"})):i.match("ui-list")&&!i.match("selected")?(this.$el.find(".ui-radio__label").addClass("cart-shipping-options-header"),n.$el.removeClass("cart-packages__expandable--animate"),n.thisInstance.triggerMethod("customTrack",{event:"click",inputName:"selectedShippingOption"})):(this.$el.find(".ui-radio__label").addClass("cart-shipping-options-header"),setTimeout(function(){return n.$el.removeClass("cart-packages__expandable--animate")},this.expandableDelay))},setClassMainElement:function(e){var t=e.$el,n=e.isExpanded;n?(t.removeClass("cart-packages__expandable--collapsed"),t.addClass("cart-packages__expandable--expanded")):(t.removeClass("cart-packages__expandable--expanded"),t.addClass("cart-packages__expandable--collapsed"))},onShow:function(){var e=this.model.get("shippingOptions");e&&e.length?(this.triggerMethod("setShippingOptionsView",{model:this.model,showChevron:!0}),this.setShippingOptionsHeaderView(),this.displayShippingOptions()):this.$el.addClass("cart-packages__single-option")}},{uiOverwritten:!0,eventsOverwritten:!0,behaviorsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){t.extendView(e.SelectionListLayout,{getTemplate:function(){return t.Utils.getTemplate(t.Checkout.templates.steps.selectionList,'[data-component="selection-list"]')},ui:{selectionListRegion:'[data-js="selection-list-items"]',errorMessage:'[data-js="ui-list__error"]',submitButton:'[data-js="list-submit"]'},regions:{selectionList:"@ui.selectionListRegion"},events:{"click @ui.submitButton":"handleClickSend"},onShow:function(){t.Checkout.ScrollUtils.scrollTo({offsetTop:0,duration:0}),this.renderSelectionListItems(),this.bindRadioClickEvent()},renderSelectionListItems:function(){var t=this.options.output?this.options.output:this.model.get("inputs").selectionList.data.inputToUse;this.selectionListItemsView=new e.SelectionListItems({collection:this.collection,output:t}),this.getRegion("selectionList").show(this.selectionListItemsView)},bindRadioClickEvent:function(){this.selectionListItemsView.on("radioClick",this.onRadioClick.bind(this))},onRadioClick:function(){this.hideListError()},showListError:function(){this.ui.selectionListRegion.addClass("ui-options-container--error"),this.ui.errorMessage.removeClass("ui-list__error-hidden")},hideListError:function(){this.ui.selectionListRegion.removeClass("ui-options-container--error"),this.ui.errorMessage.addClass("ui-list__error-hidden")},handleClickSend:function(e){e.preventDefault();var t=this.selectionListItemsView.children.filter(function(e){return e.model.get("selected")===!0})[0];return t?(t.send(t.model.get("value")),!0):(this.showListError(),!1)}},{uiOverwritten:!0,eventsOverwritten:!0,behaviorsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t){t.extendView(e.ShippingMapLayout,{buildModel:function(){var e=t.channels.flow.request("step:data"),n=new Backbone.DeepModel(e);return n.set("data.agencyAttribute",this.selectorAgencyLink),n.set("data.searchBoxInSide",!0),n.set("data.infoBox",!0),n.set("data.sidebar",!0),n}})}),App.module("Checkout.Shipping.Views",function(e,t){t.extendView(e.ShippingAgenciesMapLayout,{buildModel:function(){var e=t.channels.flow.request("step:data"),n=new Backbone.DeepModel(e);return n.set("data.agencyAttribute",this.selectorAgencyLink),n.set("data.chevronCarousel",!0),n.set("data.searchBoxInSide",!0),n.set("data.infoBox",!0),n.set("data.carousel",!0),n}})}),App.module("Checkout.Shipping.Views",function(e,t){t.extendView(e.ShippingContext,{behaviors:{AddressSelectionCaller:{behaviorClass:t.Checkout.Behaviors.AddressSelectionCaller,isModal:!0,actionInList:!0},TrackingInputs:{behaviorClass:t.Behaviors.TrackingInputs,inputs:["nextStepAddressChange"],trackIfPresent:!0},Spinner:{behaviorClass:t.Behaviors.Spinner,mode:"fullscreen",showOn:"beginSave",hideOn:"flowSaved"}},showAddressList:function(){}},{behaviorsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t){t.extendView(e.ShippingSelection,{summaryComponentModifier:null})}),App.module("Checkout.Shipping.Views",function(e,t,n,i){t.extendView(e.ShippingOptions,{template:t.Checkout.templates.components.shipping._shippingOptionContainer,childViewContainer:'[data-js="shipping-options-list"]',collectionEvents:{change:"render"},childEvents:{"radio:click":"handleClick"},getChildView:function(){return this.options.isModalView?e.ShippingOption:e.ShippingOptionWithRadioButton},onShow:function(){var e=this.children.filter(function(e){return e.model.get("selected")===!0})[0];e&&this.trigger("radioClick")},childViewOptions:function(){return{packageId:this.options.packageId,shippingOptionsSelectionView:this.options.shippingOptionsSelectionView,isModalView:this.options.isModalView,inCollection:!0,hideChevron:this.options.hideChevron,autoRipple:this.options.autoRipple,isPackage:this.options.isPackage}},handleClick:function(e){e.model.set("selected",!0);var t=this.children.filter(function(t){return t.model!==e.model});t.forEach(function(e){e.model.set("selected",!1)}),this.trigger("radioClick"),this.trigger("packageRadioClick")},unSelectAllOptions:function(){this.children.forEach(function(e){e.model.set("selected",!1)})}},{uiOverwritten:!0,eventsOverwritten:!0})}),App.module("Checkout.Shipping.Views",function(e,t,n,i,o){t.extendView(e.HubAddressesLayout,{onShow:function(){this.renderAddressOptions(),this.setButtonsStyle(),this.bindEvents(),this.bindScrollEvent()},bindScrollEvent:function(){var e=this.contentHeight,n=this.ui.buttonsSection;o(window).scroll(function(){var i=t.Checkout.ScrollUtils.isElementInView(n,!0),o=n.offset().top;o>e&&(i?(n.removeClass("hub-addresses__fixed-buttons"),n.addClass("hub-addresses__relative-buttons")):(n.removeClass("hub-addresses__relative-buttons"),n.addClass("hub-addresses__fixed-buttons")))})},setButtonsStyle:function(){var e=o(".hub-addresses"),t=e.height(),n=o("body").height();t>=n&&(this.ui.buttonsSection.removeClass("hub-addresses__relative-buttons"),this.ui.buttonsSection.addClass("hub-addresses__fixed-buttons"))}})});